"use strict";!function(){const e=navigator.userAgent||navigator.vendor||window.opera;!!/iPhone|iPad|iPod|Android/i.test(e)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints}();const e="ImageDatabase",t="Images";function o(){return new Promise(((o,a)=>{const n=indexedDB.open(e,1);n.onupgradeneeded=e=>{e.target.result.createObjectStore(t,{keyPath:"name"})},n.onsuccess=e=>{const t=e.target.result;o(t)},n.onerror=e=>{a(e.target.error)}}))}!function(){const e=navigator.userAgent;e.match(/chrome|chromium|crios/i)||(e.match(/firefox|fxios/i)||(e.match(/safari/i)||(e.match(/opr\//i)||(e.match(/edg/i)||e.match(/msie|trident/i)))))}();function a(e,t,o){let a=document.getElementById(t),n=document.createElement(e);n.id=o,a.appendChild(n)}function n(e,t){a("canvas",e,t)}function r(e,t){a("div",e,t)}function c(e,t){a("span",e,t)}function l(e,t){a("select",e,t)}function s(e,t){a("img",e,t)}function d(e,t){a("input",e,t)}function u(e,t){a("label",e,t)}function p(e,t){document.getElementById(e).hidden=!t}if(void 0===g)var g={over:0,normal:1,click:2};if(void 0===m)var m={left:1,right:3};if(void 0===f)var f={start:0,move:1,end:2,undo:3,redo:4,mirror:5,flip:6,brightness:7,zoom:8,pan:9,whiteBalance:10};if(void 0===h)var h={w:0,h:1,data:2};if(void 0===b)var b={value:0,status:1};if(void 0===v)var v={before:0,after:1};if(void 0===w)var w={toolBar:0,scrollBar:1,colorBar:2,sysToolBar:3,displayCanvas:4};if(void 0===y)var y={id:0,pic:1,state:2,groupId:3};function I(e,t,o,a,n,i){r(o,a),$("#"+a).data("btnData",e),function(e,t){var o,a="",n=e.length;for(o=0;o<n;o++)a+='<span class="'+t+' toolBar" id="'+e[o][y.id]+'"></span>';$("#"+t).html(a)}(e,a);var c="."+a;document.getElementById(a).classList.add("scrollable"),$(c).css(t);var l,s,d=!1,u=!1,p=!1,g=!1,m=t.width,f=t.height;"right"===n&&(p=!0,m=0,d=!0),"left"===n&&(m=0,d=!0),"top-right"===n&&(p=!0,f=0,m=-t.width),"top-left"===n&&(f=0,u=!0),"bottom"===n&&(m=60,f=0,g=!0),$(c).attr("style",(function(e,o){return o+(p?" left: calc(100% - "+(t.width-e*m)+"px);":" left: "+e*m+"px;")+(" top: "+(0+e*f)+"px;")})),$(c).hover(_,T),null==i?$(c).on("click",D):$(c).on("click",i),d&&(l={top:Oa+"px",height:"calc(100% - "+Oa+"px)",width:t.width+"px",background:Ie.toolBarColorLeave,opacity:Ie.toolBarOpacityLeave,position:"absolute"},p?l.right="0px":l.left="0px",$("#"+a).css(l)),u&&function(){var e={top:"0px",height:t.height+"px",width:"calc(100% - 48px)",background:Ie.toolBarColorLeave,opacity:Ie.toolBarOpacityLeave,position:"absolute"};p?e.right="0px":e.left="0px",$("#"+a).css(e)}(),g&&(s={top:"calc(100% - "+2*Ie.scrollIconH+"px)",left:"48px",height:"30px",width:"60px",background:"#00000000",opacity:Ie.toolBarOpacityLeave,position:"absolute"},$("#"+a).css(s))}function x(e,t){var o,a=e.length;for(o=0;o<a;o++)if(t===e[o][y.id])return o;return-1}function C(e,t,o){var a,n,i,r;a="#"+e[t][y.id],n=$n(e[t][y.pic]),$(a).css("background",n),Yt?o===g.over?(i=Ie.toolBarColorEnter,r=Ie.toolBarOpacityEnter):o===g.normal?(i=Ie.toolBarColorHide,r=Ie.toolBarOpacityHide):(i=Ie.toolBarColorClick,r=Ie.toolBarOpacityClick):o===g.over?(i=Ie.toolBarColorEnter,r=Ie.toolBarOpacityEnter):o===g.normal?(i=Ie.toolBarColorLeave,r=Ie.toolBarOpacityLeave):(i=Ie.toolBarColorClick,r=Ie.toolBarOpacityClick),$(a).css("background-color",i),$(a).css("background-position","center center"),$(a).css("background-repeat","no-repeat"),$(a).css("opacity",r)}function B(e){var t,o=e.length;for(t=0;t<o;t++)1===e[t][y.state]?C(e,t,g.click):2===e[t][y.state]?C(e,t,g.over):C(e,t,g.normal)}function S(e,t){let o;const a=e.length;for(o=0;o<a;o++)if(t===e[o][y.groupId]&&e[o][y.state]>0)return o;return-1}function W(e,t){var o=1;e[t][y.state]&&(o=0);let a=e[t][y.groupId];if(function(e,t){var o,a=0,n=e.length;for(o=0;o<n;o++)t===e[o][y.groupId]&&(a+=1);return a}(e,a)>1&&(o=1),a>0){let o=S(e,a);if(o>=0&&a===e[o][y.groupId]&&(e[o][y.state]=0,C(e,o,g.normal)),o==t)return}e[t][y.state]=o,o&&(C(e,t,g.click),0===a&&setTimeout((function(){e[t][y.state]=0,C(e,t,g.normal)}),100))}function k(e,t){var o="#"+e.target.id,a=$(o).parent().data("btnData"),n=x(a,e.target.id);0===a[n][y.state]&&C(a,n,t)}function _(e){k(e,g.over)}function T(e){k(e,g.normal)}function D(e){gn(w.toolBar,g.click,e);var t=$("#"+e.target.id).parent().data("btnData"),o=x(t,e.target.id);o>=0&&W(t,o)}function H(e,t,o){var a,n=$("#"+e).data("btnData");for(a=0;a<n.length;a++)if(t==n[a][y.id])return n[a][y.state]=o,void B(n)}function M(e,t){var o,a=$("#"+e).data("btnData");for(o=0;o<a.length;o++)a[o][y.state]=t;B(a)}if(void 0===P)var P={color:0,state:1};function z(e,t,o,a,n){var i,c,l,s;r(o,a),i={position:"absolute","margin-left":"0px",background:Ie.drawSetBackground,opacity:Ie.drawSetOpacity},c=e.length,l=Ie.colorIconW,s=Ie.colorIconH,i.width=l*c+"px",i.height=s+"px",i.left="calc(100% - "+l*c+"px)",i.top="0px",$("#"+a).css(i),e.fnNotify=n,$("#"+a).data("colorData",e),function(e,t){var o,a,n=e.length;for(o=0;o<n;o++)r(t,a=e[o][P.color]),$("#"+a).addClass(t+" colorBar")}(e,a);var d="."+a;$(d).css(t),$(d).attr("style",(function(o,a){return a+(" left: calc(100% - "+t.width*(o+1)+"px);")+" top: 0px;"+(" background: #"+e[o][P.color]+";")+(" margin: "+Ie.colorIconMarginNormal+"px;")+(" width: "+(t.width-2*Ie.colorIconMarginNormal)+"px;")+(" height: "+(t.height-2*Ie.colorIconMarginNormal)+"px;")})),$(d).hover(A,E),$(d).on("click",F),X($("#"+a))}function F(e){var t,o=$("#"+e.target.id).parent().data("colorData");for(t=0;t<o.length;t++)e.target.id===o[t][P.color]?o[t][P.state]=1:o[t][P.state]=0;O(o),X($("#"+e.target.id).parent()),gn(w.colorBar,g.click,e)}function R(e,t){var o="#"+e.target.id,a=$(o).parent().data("colorData"),n=function(e,t){var o,a=e.length;for(o=0;o<a;o++)if(t===e[o][P.color])return o;return-1}(a,e.target.id);0===a[n][P.state]&&L(a,n,t)}function A(e){R(e,g.over)}function E(e){R(e,g.normal)}function L(e,t,o){var a,n,i="#"+e[t][P.color];o===g.over?(a=Ie.colorIconMarginOver,n=Ie.colorIconW-2*Ie.colorIconMarginNormal):o===g.normal?(a=Ie.colorIconMarginNormal,n=Ie.colorIconW-2*Ie.colorIconMarginNormal):(a=Ie.colorIconMarginClick,n=Ie.colorIconW-2*Ie.colorIconMarginClick),$(i).css("margin",a+"px"),$(i).css("width",n+"px"),$(i).css("height",n+"px")}function O(e){var t,o=e.length;for(t=0;t<o;t++)1===e[t][P.state]?L(e,t,g.click):L(e,t,g.normal)}function Y(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(e,t,o,a){return t+t+o+o+a+a}));var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function X(e){var t,o,a,n,i,r=$(e).data("colorData");if(r.fnNotify)for(o=0;o<r.length;o++)r[o][P.state]&&(a=Y("#"+(t=r[o][P.color])).r,n=Y("#"+t).g,i=Y("#"+t).b,r.fnNotify(t,a,n,i))}if(void 0===P)P={color:0,state:1};function G(e,t,o,a,i){var r,l,s,d;c(o,a),r={position:"absolute","margin-left":"0px",background:Ie.drawSetBackground,opacity:Ie.drawSetOpacity},l=e.length,s=Ie.cb2BlockW,d=Ie.cb2BlockH,r.width=s*l+"px",r.height=d+"px",r.top="40px",r.left="0px",$("#"+a).css(r),e.fnNotify=i,$("#"+a).data("colorData",e),function(e,t){var o,a,i,r,l,s,d,u,p,g,m,f,h=e.length;d=Ie.cb2BlockW-2*Ie.cb2FrameGap,u=Ie.cb2BlockH-2*Ie.cb2FrameGap;var b={position:"absolute",left:Ie.cb2FrameGap,top:Ie.cb2FrameGap,width:d,height:u,opacity:1},v={position:"absolute",left:0,top:0,width:Ie.scrollIconW,height:Ie.scrollIconH,opacity:1};for(o=0;o<h;o++){p=K("#"+(f=e[o][P.color])).r,g=K("#"+f).g,m=K("#"+f).b,c(t,a=f),r="#"+a,v.left=(h-1-o)*Ie.scrollIconW,$(r).css(v),n(a,i=a+"_canvas"),r="#"+i,$(r).hover(q,V),$(r).on("click",U),$(r).css(b),$(r).attr("width",d),$(r).attr("height",u),s=(l=document.getElementById(i)).getContext("2d"),ja(l);var w="rgba("+p+", "+g+", "+m+", 1)";s.fillStyle=w,s.fillRect(0,0,d,u)}}(e,a),J($("#"+a))}function U(e){var t,o=e.target.id,a=$("#"+o).parent().attr("id"),n=$("#"+a).parent().attr("id"),i=$("#"+n).data("colorData");for(t=0;t<i.length;t++)a===i[t][P.color]?i[t][P.state]=1:i[t][P.state]=0;Z(i),J($("#"+n)),gn(w.colorBar,g.click,e)}function N(e,t){var o=e.target.id,a=$("#"+o).parent().attr("id"),n=$("#"+a).parent().attr("id"),i=$("#"+n).data("colorData"),r=function(e,t){var o,a=e.length;for(o=0;o<a;o++)if(t===e[o][P.color])return o;return-1}(i,a);0===i[r][P.state]&&j(i,r,t)}function q(e){N(e,g.over)}function V(e){N(e,g.normal)}function j(e,t,o){var a,n="#"+e[t][P.color];a=o===g.over?Ie.cb2MouseColorEnter:o===g.normal?Ie.cb2MouseColorLeave:Ie.cb2MouseColorClick,$(n).css("background",a)}function Z(e){var t,o=e.length;for(t=0;t<o;t++)1===e[t][P.state]?j(e,t,g.click):j(e,t,g.normal)}function K(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(e,t,o,a){return t+t+o+o+a+a}));var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function J(e){var t,o,a,n,i,r=$(e).data("colorData");if(r.fnNotify)for(o=0;o<r.length;o++)r[o][P.state]&&(a=K("#"+(t=r[o][P.color])).r,n=K("#"+t).g,i=K("#"+t).b,r.fnNotify(t,a,n,i))}function Q(e){var t="#"+e.target.id,o=$(t).parent().data("scrollData"),a=e.offsetX;a<=Ie.scrollTickH/2&&(a=0),a>o.length&&(a=o.length),o.curPos=a,ee(o.id),te(o.id)}function ee(e){var t,o,a,n,i,r,c,l,s=$("#"+e).data("scrollData");o=(t=document.getElementById(e+"-canvas")).getContext("2d"),ja(t),l=(s.iconSize-Ie.scrollTickH)/2,a=Ie.scrollTickH/2,n=l+(Ie.scrollTickH-Ie.scrollLineH)/2,i=s.length,r=Ie.scrollLineH,o.rect(a,n,i,r),o.fillStyle=s.color,o.fill(),a=Ie.scrollTickH/2+s.curPos,n=l+Ie.scrollTickH/2,c=Ie.scrollTickH/2,o.arc(a,n,c,0,2*Math.PI,!1),o.fillStyle=s.color,o.fill()}function te(e){var t=$("#"+e).data("scrollData");t.fnNotify&&t.fnNotify(t.length,t.curPos)}function oe(e,t){var o=$("#"+e).data("scrollData");t<=o.length&&(o.curPos=t,ee(e))}function ae(){var e,t,o="configDrawDlg";r("uiArea",o),e="#"+o,$(e).css("background",ye.ColorLeave),$(e).css("top","calc(100% - 100px)"),$(e).css("left",Ea-300-Ie.toolBarIconW+"px"),$(e).css("width","300px"),$(e).css("height","70px"),$(e).css("position","absolute"),$(e).hide(),function(){var e={iconL:"30x_30alpha.png",iconSize:Ie.scrollIconH,length:Ie.scrollOpacityW,curPos:Ie.scrollOpacityDefPos,startX:0,startY:0,color:Ie.scrollColor};if(0===Ie.disableDrawingOpacityScrollBar){function o(e){var t;t=e.currentTarget?e.currentTarget.value:e,Sa.opacity=.1+t/100*.9,Sa.opacity=Sa.opacity.toFixed(1),tn()}st(e,"configDrawDlg","drawingOpacity",o,100)}var t={iconL:"30x30lineWidth.png",iconSize:Ie.scrollIconH,length:Ie.scrollLineWidthW,curPos:Ie.scrollLineWidthDefPos,startX:160,startY:0,color:Ie.scrollColor};if(0===Ie.disableDrawingLineWidthScrollBar){function a(e){var t;t=e.currentTarget?e.currentTarget.value:e,Sa.lineWidth=Ie.lineWidthMin+(Ie.lineWidthMax-Ie.lineWidthMin)*(t/100),Sa.lineWidth=Math.floor(Sa.lineWidth)}st(t,"configDrawDlg","drawingLineWidth",a,10)}}(),t={position:"absolute",width:Ie.colorIconW,height:Ie.colorIconH,"margin-left":"0px",opacity:Ie.colorIconOpacity},1===Ie.disableColorBar?(z(ze,t,"configDrawDlg","drawingCfgColorBar",lt),O(ze)):Ie.cb2Apply?(G(Pe,0,"configDrawDlg","drawingCfgColorBar",lt),Z(Pe)):(z(Pe,t,"configDrawDlg","drawingCfgColorBar",lt),O(Pe))}function ne(e,t,o,a,n){var i=t+"-icon";c(e,i),i="#"+i,$(i).css({background:$n(o),top:n,left:a,width:Ie.toolBarIconW+"px",height:Ie.toolBarIconH+"px",position:"absolute"});var r=t+"-slider";return d(e,r),i="#"+r,$(i).attr("class","slider"),$(i).css({top:n,left:a+Ie.toolBarIconW+16,width:"200px",height:Ie.toolBarIconH+"px",position:"absolute"}),c(e,i=t+"-reset"),i="#"+i,$(i).css("background",$n("undo.png")),$(i).css("top",n+"px"),$(i).css("left",a+Ie.toolBarIconW+16+200+16+"px"),$(i).css("width",Ie.toolBarIconW+"px"),$(i).css("height",Ie.toolBarIconH+"px"),$(i).css("position","absolute"),$(i).on("click",(function(){"configDlg-rotate-slider"==r?$("#"+r).val(0):$("#"+r).val(1),$("#"+r).trigger("input")})),r}function ie(e,t,o,a,i,r=!1){var l,s,d,u,p={position:"absolute","margin-left":"0px",background:Ie.scrollDlgBkg,opacity:Ie.scrollDlgOpacity};c(o,a),s=e.iconSize+Ie.scrollIconGap+e.length+Ie.scrollTickH,void 0!==e.iconR&&(s+=Ie.scrollIconGap+e.iconSize),d=e.iconSize+Ie.toolBarIconH,p.left="calc(50% - "+s/2+"px)",p.top="calc(50% - "+(d-Ie.titleIconH)/2+"px)",p.width=s+"px",p.height=d+"px",$("#"+a).css(p),c(a,l=a+"-close"),l="#"+l,u=$n("close.png"),$(l).css("background",u),$(l).css("top","0px"),$(l).css("left",s-Ie.toolBarIconW+"px"),$(l).css("width",Ie.toolBarIconW+"px"),$(l).css("height",Ie.toolBarIconH+"px"),$(l).css("position","absolute"),$(l).on("click",re),r&&(c(a,l=a+"-reset"),l="#"+l,u=$n("undo.png"),$(l).css("background",u),$(l).css("top","0px"),$(l).css("left",s/2-Ie.toolBarIconW/2+"px"),$(l).css("width",Ie.toolBarIconW+"px"),$(l).css("height",Ie.toolBarIconH+"px"),$(l).css("position","absolute"),$(l).on("click",(function(){oe(a+"-scrollbar",e.length/2),ee(a+"-scrollbar"),te(a+"-scrollbar")}))),l=a+"-scrollbar",e.startY=Ie.toolBarIconH,function(e,t,o,a,i){var r,l,s,d,u,p,f,h,b;c(o,a),f=e.iconSize+Ie.scrollIconGap+e.length+Ie.scrollTickH,void 0!==e.iconR&&(f+=Ie.scrollIconGap+e.iconSize),t.left=e.startX+"px",t.top=e.startY+"px",t.width=f+"px",t.height=e.iconSize+"px",$("#"+a).css(t),e.id=a,e.mouseDown=!1,e.fnNotify=i,$("#"+a).data("scrollData",e),c(a,r=a+"-iconL"),n(a,h=a+"-canvas"),d=0,l="#"+r,s=$n(e.iconL),$(l).css("background",s),$(l).css("top","0px"),$(l).css("left",d+"px"),$(l).css("width",e.iconSize+"px"),$(l).css("height",e.iconSize+"px"),$(l).css("position","absolute"),d+=e.iconSize,d+=Ie.scrollIconGap,l="#"+h,u=e.length+Ie.scrollTickH,p=e.iconSize,$(l).css("top","0px"),$(l).css("left",d+"px"),$(l).css("width",u+"px"),$(l).css("height",p+"px"),$(l).css("position","absolute"),$(l).attr("width",u),$(l).attr("height",p),d+=u,void 0!==e.iconR&&(c(a,r=a+"-iconR"),d+=Ie.scrollIconGap,l="#"+r,s=$n(e.iconR),$(l).css("background",s),$(l).css("top","0px"),$(l).css("left",d+"px"),$(l).css("width",e.iconSize+"px"),$(l).css("height",e.iconSize+"px"),$(l).css("position","absolute")),te(a),l="#"+h,b=$("#"+a).data("scrollData"),$(l).on("mousedown",(function(e){m.left===e.which&&(b.mouseDown=!0,Q(e),gn(w.scrollBar,g.click,e))})).on("mousemove",(function(e){b.mouseDown&&Q(e)})).on("mouseup",(function(){m.left===event.which&&(b.mouseDown=!1)})).on("mouseout",(function(){m.left===event.which&&(b.mouseDown=!1)})).on("touchstart",(function(e){Ra(e)})).on("touchmove",(function(e){Ra(e)})).on("touchend",(function(){Ra(event)})).on("touchcancel",(function(){Ra(event)}))}(e,t,a,l,i),ee(l)}function re(e){ln()}if(void 0===ce)var ce={move:0,trAnchor:1,tlAnchor:2,brAnchor:3,blAnchor:4,down:5};function le(){var e,t,o,a={dispX:0,dispY:0,dispW:0,dispH:0,imgSrc:0,isActive:!1,x:0,y:0,w:0,h:0,mouseDown:!1,type:ce.down,startX:0,startY:0};$("#importPictureWin").data("picData",a),e=Ie.ipwRadius,t={position:"absolute",left:e+"px",top:e+"px",width:"calc(100% - "+2*e+"px)",height:"calc(100% - "+2*e+"px)",opacity:Ie.ipwOpacity},n("importPictureWin","importPicture"),$("#importPicture").css(t),me("importPicture",ce.move),$("#importPictureWin").on("dblclick",(function(e){ve(!0)})),o=Ie.ipwRadiusExpandRatio,(o=Math.floor(o))<1&&(o=1),Sa.ipwRadiusExpandRatio=o,se("tlAnchor",ce.tlAnchor),se("trAnchor",ce.trAnchor),se("blAnchor",ce.blAnchor),se("brAnchor",ce.brAnchor),he(!1)}function se(e,t){var o,a,i,r,c,l="#"+e,s=Ie.ipwRadius;switch(c=(r=2*s)*((i=Sa.ipwRadiusExpandRatio)-1)/2,Sa.ipwExtraSpace=c,n("importPictureWin",e),t){case ce.trAnchor:o="calc(100% - "+(r+c)+"px)",a=-c+"px";break;case ce.tlAnchor:o=-c+"px",a=-c+"px";break;case ce.brAnchor:o="calc(100% - "+(r+c)+"px)",a="calc(100% - "+(r+c)+"px)";break;case ce.blAnchor:o=-c+"px",a="calc(100% - "+(r+c)+"px)"}var d={position:"absolute",left:o,top:a,width:(r*=i)+"px",height:r+"px",opacity:Ie.ipwOpacity};$(l).css(d),$(l).attr("width",r),$(l).attr("height",r);var u=2*Math.PI,p=document.getElementById(e).getContext("2d");p.fillStyle=Ie.ipwColor,p.strokeStyle=Ie.ipwColor,p.lineWidth=Ie.ipwLineWidth,p.beginPath(),p.arc(s+c,s+c,s,0,u,!1),p.closePath(),p.fill(),me(e,t)}var de=!1;function ue(){var e=Sa.curMode.imgW/Ye,t="#importPictureWin",o=$(t).data("picData");o.x=($(t).offset().left-Ge)*e,o.y=($(t).offset().top-Ue)*e,o.w=$(t).width()*e,o.h=$(t).height()*e,o.dispX=$(t).offset().left-Ge,o.dispY=$(t).offset().top-Ue,o.dispW=$(t).width(),o.dispH=$(t).height()}function pe(e,t){var o=$("#importPictureWin").data("picData"),a=t.clientX-o.startX,n=t.clientY-o.startY,i=o.dispX,r=o.dispY,c=o.dispW,l=o.dispH;switch(e){case ce.trAnchor:c+=a,r+=n,l-=n;break;case ce.tlAnchor:i+=a,c-=a,r+=n,l-=n;break;case ce.brAnchor:c+=a,l+=n;break;case ce.blAnchor:i+=a,c-=a,l+=n}var s={left:Ge+i,top:Ue+r,width:c,height:l};$("#importPictureWin").css(s)}function ge(e){var t=$("#importPictureWin").data("picData"),o=e.clientX-t.startX,a=e.clientY-t.startY,n={left:Ge+t.dispX+o,top:Ue+t.dispY+a};$("#importPictureWin").css(n)}function me(e,t){var o="#importPictureWin",a=$(o).data("picData");Sa.curMode,Ie.ipwRadius;o="#"+e,$(o).on("mousedown",(function(e){m.left===e.which&&function(e,t){var o,a,n=2*Ie.ipwRadius,i=Sa.ipwExtraSpace;return ce.move==t||(o=e.offsetX,a=e.offsetY,o>=i&&o<i+n&&a>=i&&a<i+n)}(e,t)&&(a.mouseDown=!0,a.startX=e.clientX,a.startY=e.clientY,a.type=t,de=!0)})).on("dblclick",(function(e){ve(!0)})).on("mousemove",(function(e){if(a.mouseDown)switch(a.type){case ce.move:ge(e);break;case ce.trAnchor:case ce.tlAnchor:case ce.brAnchor:case ce.blAnchor:pe(a.type,e)}})).on("mouseup",(function(e){m.left===e.which&&(a.mouseDown=!1,ue(),de=!1)})).on("mouseout",(function(e){m.left,e.which})).on("touchstart",(function(e){Ra(e)})).on("touchmove",(function(e){Ra(e)})).on("touchend",(function(e){Ra(e)})).on("touchcancel",(function(e){Ra(e)}))}function fe(e){var t,o,a=Sa.curMode,n="#importPictureWin",i=Ie.ipwRadius;t=e.width,o=e.height;var r=200;t<r&&(o=o*r/t,t=r),o<r&&(t=t*r/o,o=r);var c,l,s,d,u=a.imgW-2*i,p=a.imgH-2*i;t>u&&(o=o*u/t,t=u),o>p&&(t=t*p/o,o=p),e.width,e.height,s=t+2*i,d=o+2*i,c=(a.imgW-s)/2,l=(a.imgH-d)/2;var g=$(n).data("picData");g.imgSrc=e,g.dispW=Ye,g.dispH=Xe,g.x=c,g.y=l,g.w=s,g.h=d,g.isActive=!0,be(),n="#importPicture",$(n).attr("width",e.width),$(n).attr("height",e.height),document.getElementById("importPicture").getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,e.width,e.height),he(!0)}function he(e){var t=$("#importPictureWin").data("picData");p("importPictureWin",e),t.isActive=e}function be(){var e,t,o,a,n,i=$("#importPictureWin").data("picData"),r=Sa.curMode;if(void 0!==i&&0!=i.isActive){n=Ye/r.imgW,e=i.x*n,t=i.y*n,o=i.w*n,a=i.h*n;var c={position:"absolute",left:Ge+e,top:Ue+t,width:o,height:a,opacity:Ie.ipwOpacity};$("#importPictureWin").css(c),i.dispX=e,i.dispY=t,i.dispW=o,i.dispH=a}}function ve(e){if(e){var t=$("#importPictureWin").data("picData"),o=Sa.curMode,a=Sa.drawContext,n=Ie.ipwRadius*o.imgW/Ye;0!=t.isActive&&(Za(),a.drawImage(t.imgSrc,0,0,t.imgSrc.width,t.imgSrc.height,t.x+n,t.y+n,t.w-2*n,t.h-2*n),an(f.end),o.imageProcess&&o.imageProcess(),he(!1),Vt&&attachCropBox(Ye,Xe))}else he(!1)}const we="SmartDc";var ye={resizeDelayMs:100,iconW:48,iconH:48,drawSetH:30,ColorEnter:"#555",ColorLeave:"#222",ColorClick:"#5B0303",ColorHide:"#000",OpacityEnter:"0.8",OpacityLeave:"0.8",OpacityClick:"0.8",OpacityHide:"0",resolutionIdx:-1,languageIdx:0},Ie={cfgVersion:"1.5.0",bgColor:"#000",titleIconH:ye.iconH,toolBarIconW:ye.iconW,toolBarIconH:ye.iconH,modeIconW:100,modeIconH:ye.iconH,mouseColorEnter:ye.ColorEnter,mouseColorLeave:ye.ColorLeave,mouseColorClick:ye.ColorClick,mouseOpacityEnter:ye.OpacityEnter,mouseOpacityLeave:ye.OpacityLeave,mouseOpacityClick:ye.OpacityClick,drawSetH:ye.drawSetH,drawSetBackground:ye.ColorLeave,drawSetOpacity:ye.OpacityLeave,colorIconW:30,colorIconH:ye.drawSetH,colorIconMarginClick:3,colorIconMarginNormal:6,colorIconMarginOver:4,colorIconOpacity:"1.0",cb2Apply:1,cb2BlockW:30,cb2BlockH:ye.drawSetH,cb2FrameGap:6,cb2MouseColorEnter:ye.ColorEnter,cb2MouseColorLeave:ye.ColorLeave,cb2MouseColorClick:ye.ColorClick,scrollIconW:30,scrollIconH:ye.drawSetH,scrollIconGap:0,scrollTickH:12,scrollLineH:2,scrollColor:"#EEE",scrollGroupGap:8,scrollOpacityW:90,scrollOpacityDefPos:80,scrollLineWidthW:90,scrollLineWidthDefPos:30,lineWidthMin:4,lineWidthMax:40,scrollDlgBkg:ye.ColorLeave,scrollDlgOpacity:ye.OpacityLeave,scrollBrighnessW:180,scrollBrighnessDefPos:90,brightnewwMin:-128,brightnewwMax:128,whiteBalanceMin:-25,whiteBalanceMax:25,scrollZoomW:180,scrollZoomDefPos:0,zoomMaxRatio:8,panWinGapX:4,panWinGapY:4,panWinColor:ye.ColorLeave,panCropColor:"#555",panOpacity:ye.OpacityLeave,sdBkg:ye.ColorLeave,sdOpacity:ye.OpacityLeave,sdIconW:ye.iconW,sdIconH:ye.iconH,sdExtraW:14,sdIconScrollGap:4,sdGroupGap:0,sdScrollGap:8,sdFrameGapX:4,sdFrameGapY:4,sdScrollH:30,sdVideoRsoW:120,sdFontFamilyW:100,sdFontStyleW:100,sdFontSizeW:48,tidBkg:ye.ColorLeave,tidOpacity:ye.OpacityLeave,tidIconW:ye.iconW,tidIconH:ye.iconH,tidTextFrmW:300,tidTextFrmH:200,tidFrameGap:8,tidIconFrmGap:4,tidTextSize:20,eraserOpacity:.8,minArrowSize:10,toolBarColorEnter:ye.ColorEnter,toolBarColorLeave:ye.ColorLeave,toolBarColorClick:ye.ColorClick,toolBarColorHide:ye.ColorHide,toolBarOpacityEnter:ye.OpacityEnter,toolBarOpacityLeave:ye.OpacityLeave,toolBarOpacityClick:ye.OpacityClick,toolBarOpacityHide:ye.OpacityHide,ipwColor:"#AAA",ipwOpacity:1,ipwLineWidth:6,ipwRadius:16,ipwRadiusExpandRatio:1,defPreviewRsoX:1280,defPreviewRsoY:720,defDrawingBoardW:1920,defDrawingBoardH:1080,drawingBoardBgColor:"#FFF",defPictureW:1920,defPictureH:1080,thumbW:160,thumbH:120,thumbPadding:10,thumbFrmSize:4,thumbFrmColorNormal:"#000",thumbFrmColorChecked:"#FF0",pbInfoW:240,pbInfoH:24,pbInfoColor:"#FF0",pbInfoColor_Page:"#FF0",pbInfoColor_Item:"#3F3",pbInfoFontSize:"150%",pbInfoFontWWeight:"normal",aboutWinW:400,aboutWinH:340,aboutBkg:"#222",aboutOpacity:1,aboutIconW:ye.iconW,aboutIconH:ye.iconH,aboutGapX:30,pcdBkg:ye.ColorLeave,pcdOpacity:ye.OpacityLeave,pcdIconOverlayY:20,pcdIconW:ye.iconW,pcdIconH:ye.iconH,pcdTextW:80,pcdTextH:20,pcdUnitW:60,pcdUnitH:16,pcdUnitOffsetY:4,pcdExtraW:12,pcdCapturePeriodSec:1,pcdCaptureIntervalHour:1,pcibBkg:ye.ColorLeave,pcibOpacity:ye.OpacityLeave,pcibIconW:ye.iconW,pcibIconH:ye.iconH,pcibTextH:24,pcibTextW:120,pcibTextColor:"#2F2",pcibTextFontSize:"150%",pcidGapY:4,cdIconW:ye.iconW,cdIconH:ye.iconH,cdFrameGap:26,cdIconGap:10,cdBkg:ye.ColorLeave,cdOpacity:ye.OpacityLeave,cdMouseColorEnter:ye.ColorEnter,cdMouseColorLeave:ye.ColorLeave,cdMouseColorClick:ye.ColorClick,sysInfoWinW:88,sysInfoWinH:82,sysInfoH:16,sysInfoGap:4,disableDrawingCanvasOverlay:0,disableDrawingToolBar:0,disableColorBar:0,disableDrawingOpacityScrollBar:0,disableDrawingLineWidthScrollBar:0,disableDrawTextSetting:0},xe=[["btn_freehand","freeHand.png",0,1],["btn_arrow","arrow.png",0,1],["btn_eraser","ereser.png",0,1],["btn_line","line.png",0,1],["btn_rectangleLine","rectangleLine.png",0,1],["btn_rectangle","rectangle.png",0,1],["btn_circleLine","circleLine.png",0,1],["btn_circle","circle.png",0,1],["btn_erase_all","clearAll.png",0,0],["btn_text","text.png",0,1],["btn_configDraw","config2.png",0,0]],Ce=[],$e=[],Be=[["btn_setting","setting.png",0,0],["btn_capture","capture.png",0,0],["btn_record","record2.png",0,0],["btn_freeze","Freeze.png",0,3],["btn_mirrow","mirrow.png",0,5],["btn_flip","flip.png",0,6],["btn_config","config.png",0,0],["btn_zoom","zoom.png",0,0],["btn_importPic","inportPic.png",0,0],["btn_redo","redo.png",0,0],["btn_undo","undo.png",0,0]],Se=[["scbtn_transform","perspectiveImage.png",0,0],["scbtn_importPic","inportPic.png",0,0],["Dummy","dummy.png",0,0],["scbtn_fullcrop","fullPhoto.png",0,6],["scbtn_redo","redo.png",0,0],["scbtn_undo","undo.png",0,0]],We=[["scbtn_preview","backScanMode.png",0,0],["scbtn_saveDisk","savePlayback.png",0,0],["scbtn_ocr","ocr.png",0,0],["Dummy","dummy.png",0,0],["scbtn_mirrow","mirrow.png",0,5],["scbtn_flip","flip.png",0,6],["scbtn_redo2","redo.png",0,0],["scbtn_undo2","undo.png",0,0]],ke=[["mscbtn_capture","perspectiveImage.png",0,0],["mscbtn_merge","Merge_multiscan.png",0,0],["mscbtn_cancel","close.png",0,0],["Dummy","dummy.png",0,0],["mscbtn_fullcrop","fullPhoto.png",0,6]],_e=[["mode_about","about.png",0,0],["mode_preview","preview.png",1,1],["mode_drawingBoard","drawingboard.png",0,1]],Te=[["sys_fullPhoto0","fullPhoto.png",0,1]],De=[["btn_saveDisk","saveDisk.png",0,0],["btn_delete","delete.png",0,0],["Dummy","dummy.png",0,0],["btn_Next","next_page.png",0,0],["btn_Previous","previous_page.png",0,0]],He=[["ppbtn_savePlayback","savePlayback.png",0,0],["ppbtn_closeAndBackPlayback","closeAndBackPlayback.png",0,0],["ppbtn_zoom","zoom.png",0,0],["ppbtn_importPic","inportPic.png",0,0],["ppbtn_redo","redo.png",0,0],["ppbtn_undo","undo.png",0,0]],Me=[["dbbtn_savePlayback","savePlayback.png",0,0],["dbbtn_redo","redo.png",0,0],["dbbtn_undo","undo.png",0,0],["dbbtn_importPic","inportPic.png",0,0]],Pe=[["782D91",0],["1B1464",0],["0000FF",1],["00FF00",0],["FFFF00",0],["F15A24",0],["FF0000",0],["FFFFFF",0],["999999",0],["000000",0]],ze=[],Fe=[["Arial",1],["Serif",0],["Verdana",0],["Courier New",0]],Re=[["lbNormal",1],["lbBold",0],["lbItalic",0],["lbBoldItalic",0]],Ae=[["English",1,"./locales/en/messages.json"],["Deutsch",0,"./locales/de/messages.json"],["Française",0,"./locales/fr/messages.json"],["Español",0,"./locales/es/messages.json"],["日本語",0,"./locales/jp/messages.json"],["繁體中文",0,"./locales/zh_TW/messages.json"],["Русский",0,"./locales/ru/messages.json"],["한국어",0,"./locales/ko/messages.json"],["Italiano",0,"./locales/it/messages.json"],["简体中文",0,"./locales/sc/messages.json"]],Ee=[[8,0],[12,0],[16,0],[20,0],[24,0],[28,1],[36,0],[48,0],[72,0]];var Le,Oe,Ye,Xe,Ge,Ue,Ne,qe,Ve,je=[[1920,1080,0],[1280,720,1],[1280,1024,0]];function Ze(e,t,o){var a={position:"absolute",left:0,top:0,width:t,height:o,display:!1},n="#"+e;$(n).css(a),$(n).attr("width",t),$(n).attr("height",o)}function Ke(e,t,o,a){n(e,t),Ze(t,o,a)}function Je(e){var t,o,a=["videoOrg","WebGL","baseImageCanvas","imageProcessCanvas","drawingCanvas","tempDrawingCanvas","combineCanvas"];for(t=0;t<a.length;t++)o=e+"-"+a[t],document.getElementById(o).hidden=!0}function Qe(e,t,o){var a,n,i=["videoOrg","WebGL","baseImageCanvas","imageProcessCanvas","tempDrawingCanvas","combineCanvas"];for(n=0;n<i.length;n++)Ke(e,a=e+"-"+i[n],t,o);a=e+"-drawingCanvas";let r=1.5*Math.max(window.screen.width,window.screen.height);Ke(e,a,r,r)}function et(e,t,o){let a,n;const i=["WebGL","baseImageCanvas","imageProcessCanvas","tempDrawingCanvas","combineCanvas"];for(n=0;n<i.length;n++)a=e.baseId+"-"+i[n],Ze(a,t,o);a=e.baseId+"-videoOrg",Ze(a,fi,hi)}function tt(e){var t,o,a=["baseImageCanvas","imageProcessCanvas","drawingCanvas","tempDrawingCanvas","combineCanvas"],n=["baseImageContext","imageProcessContext","drawingContext","tempDrawingContext","combineContext"];for(o=0;o<a.length;o++)t=e.baseId+"-"+a[o],e[a[o]]=document.getElementById(t),e[n[o]]=e[a[o]].getContext("2d")}!function(e,t){let o=document.createElement(e);o.id=t,document.body.appendChild(o)}("div","baseArea"),r("baseArea","appTitle"),r("baseArea","previewArea"),a("video","previewArea","videoSrc"),Qe("previewArea",Ie.defPreviewRsoX,Ie.defPreviewRsoY),r("baseArea","playbackArea"),Qe("playbackArea",Ie.defPictureW,Ie.defPictureH),r("baseArea","drawingArea"),Qe("drawingArea",Ie.defDrawingBoardW,Ie.defDrawingBoardH),r("baseArea","imageDisplayArea"),n("imageDisplayArea","displayCanvas"),n("imageDisplayArea","saveFileCanvas"),r("baseArea","uiArea"),c("uiArea","importPictureWin"),r("uiArea","drawingCfgArea"),Ne={position:"absolute","margin-left":"0px",background:Ie.drawSetBackground,opacity:Ie.drawSetOpacity},qe=Ie.toolBarIconW,Ve=Ie.drawSetH,Ne.width="calc(100% - "+2*qe+"px)",Ne.height=Ve+"px",Ne.left=qe+"px",Ne.top="calc(100% - "+Ve+"px)",$("#drawingCfgArea").css(Ne),c("uiArea","panWin"),n("panWin","cropWin"),c("uiArea","settingDlg"),c("uiArea","textInputDlg"),Le=document.getElementById("displayCanvas"),Oe=Le.getContext("2d"),Je("previewArea"),Je("playbackArea"),Je("drawingArea"),p("saveFileCanvas",!1);var ot={position:"absolute",left:0,top:0,width:800,height:260,style:"border:1px dashed black",background:Ie.bgColor};function at(){let e,t,o,a,n,i,r;Yt?(i=t=Ea,r=o=La,a=0,n=0):(i=t=Ea-2*ye.iconW,r=o=La-Oa-ye.drawSetH,a=ye.iconW,n=Oa),ot.left=a,ot.top=n,ot.width=i,ot.height=r,e=$("#displayCanvas"),e.css(ot),e.attr("width",i),e.attr("height",r),Ge=a,Ue=n,Ye=i,Xe=r,nr(fi,hi,i,r)}var nt,it,rt=[];function ct(e,t){p(e,t)}function lt(e,t,o,a){Sa.colorHex=e,Sa.colorR=t,Sa.colorG=o,Sa.colorB=a,tn()}function st(e,t,o,a,n){c(t,o);var i=o+"-iconL";c(o,i);var r=e.startX;u="#"+i;var l=$n(e.iconL);$(u).css("background",l),$(u).css("top","0px"),$(u).css("left",r+"px"),$(u).css("width",e.iconSize+"px"),$(u).css("height",e.iconSize+"px"),$(u).css("position","absolute"),r+=e.iconSize;var s=o+"-slider";d(t=o,s);var u="#"+s;$(u).attr("class","slider_min"),$(u).css({top:0,left:r,width:"100px",height:"30px",position:"absolute"}),$(u).attr({type:"range",max:100,min:0,step:2,value:n});u="#"+s;$(u).on("input",a),a(n)}function dt(){var e={position:"absolute","margin-left":"0px"};ie({iconL:"brightness_down.png",iconR:"brightness_up.png",iconSize:Ie.toolBarIconW,length:Ie.scrollBrighnessW,curPos:Ie.scrollBrighnessDefPos,startX:0,startY:0,color:Ie.scrollColor},e,"uiArea","brightnessDlg",gt,!0),ut(!1),ie({iconL:"wb_b.png",iconR:"wb_r.png",iconAuto:"undo.png",iconSize:Ie.toolBarIconW,length:Ie.scrollBrighnessW,curPos:Ie.scrollBrighnessDefPos,startX:0,startY:0,color:Ie.scrollColor},e,"uiArea","whiteBalanceDlg",mt,!0),pt(!1),function(){var e,t,o="zoomDlg",a=24,n=36,i=380,l=120;r("uiArea",o),e="#"+o,$(e).css("background",ye.ColorLeave),$(e).css("top","calc(50%)"),$(e).css("left",Ie.toolBarIconW+"px"),$(e).css("width",i+"px"),$(e).css("height",l+"px"),$(e).css("position","absolute"),$(e).hide();t=function(e,t,o,a,n,i){var r;c(e,r=t+"-icon-L"),r="#"+r,$(r).css({background:$n(o),top:i,left:n,width:Ie.toolBarIconW+"px",height:Ie.toolBarIconH+"px",position:"absolute"}),c(e,r=t+"-icon-R"),r="#"+r,$(r).css({background:$n(a),top:i,left:n+Ie.toolBarIconW+16+200+16,width:Ie.toolBarIconW+"px",height:Ie.toolBarIconH+"px",position:"absolute"});var l=t+"-slider";return d(e,l),r="#"+l,$(r).attr("class","slider"),$(r).css({top:i,left:n+Ie.toolBarIconW+16,width:"200px",height:Ie.toolBarIconH+"px",position:"absolute"}),l}(o,e=o+"-zoom","zoom_in.png","zoom_out.png",a,n),e="#"+t,$(e).attr({type:"range",max:100,min:0,step:2,value:0}),$(e).on("input",(function(e){var t=1+(Ie.zoomMaxRatio-1)*e.currentTarget.value/100;t=t.toFixed(1),Sa.curMode&&Wn(t,e.currentTarget.value)}))}()}function ut(e){p("brightnessDlg",e)}function pt(e){p("whiteBalanceDlg",e)}function gt(e,t){}function mt(e,t){}function ft(){var e,t,o,a,n,i,r,c,s,d,u={position:"absolute","margin-left":"0px",background:Ie.sdBkg,opacity:Ie.sdOpacity},p=3;1===Ie.disableDrawTextSetting&&(p=1),e=2*Ie.sdFrameGapX+Ie.sdIconW+Ie.sdIconScrollGap+Ie.sdFontFamilyW+Ie.sdFontStyleW+Ie.sdFontSizeW+2*Ie.sdScrollGap,e+=Ie.sdExtraW,t=Ie.sdFrameGapY*p+Ie.sdIconH*(p+1)+Ie.sdGroupGap,u.left="calc(50% - "+e/2+"px)",u.top="calc(50% - "+(t-Ie.titleIconH)/2+"px)",u.width=e+"px",u.height=t+"px",$("#settingDlg").css(u),o=e-Ie.sdFrameGapX-Ie.sdIconW,a=Ie.sdFrameGapY,ht("settingDlg","sdVideoinputIcon","setting_videoinput.png",o=Ie.sdFrameGapX,a),o+=Ie.sdIconW+Ie.sdIconScrollGap,n="settingDlg",i="sdVideoinputScrollbar",Sa.curVideopinputList,r=o,c=a,s=Ie.sdVideoRsoW,Sa.idVideoinputSelect=i,l(n,i),d="#"+i,$(d).css("top",c+(Ie.sdIconH-Ie.sdScrollH)/2+"px"),$(d).css("left",r+"px"),$(d).css("width",2*s+6*Ie.sdIconScrollGap+"px"),$(d).css("height",Ie.sdScrollH+"px"),$(d).css("position","absolute"),a+=Ie.sdIconH+Ie.sdGroupGap,ht("settingDlg","sdAudioinputIcon","setting_audioinput.png",o=Ie.sdFrameGapX,a),o+=Ie.sdIconW+Ie.sdIconScrollGap,function(e,t,o,a,n,i){var r;Sa.idAudioinputSelect=t,l(e,t),r="#"+t,$(r).css("top",n+(Ie.sdIconH-Ie.sdScrollH)/2+"px"),$(r).css("left",a+"px"),$(r).css("width",2*i+6*Ie.sdIconScrollGap+"px"),$(r).css("height",Ie.sdScrollH+"px"),$(r).css("position","absolute")}("settingDlg","sdAudioinputScrollbar",Sa.curAudioinputList,o,a,Ie.sdVideoRsoW),a+=Ie.sdIconH+Ie.sdGroupGap,0===Ie.disableDrawTextSetting&&(ht("settingDlg","sdFontIcon","setting_textEdit.png",o=Ie.sdFrameGapX,a),o+=Ie.sdIconW+Ie.sdIconScrollGap,bt("settingDlg","sdfontFamily",Fe,o,a,Ie.sdFontFamilyW),o+=Ie.sdFontFamilyW+Ie.sdScrollGap,function(e,t,o,a,n,i){var r,c,s,d="";for(l(e,t),d="",r=0;r<o.length;r++)c=t+"-"+o[r][b.value],s="WebMod",d+="<option"+(1===o[r][b.status]?' selected="true"':"")+' id="'+c+'">'+s+"</option>";$("#"+t).html(d),c="#"+t,$(c).css("top",n+(Ie.sdIconH-Ie.sdScrollH)/2+"px"),$(c).css("left",a+"px"),$(c).css("width",i+"px"),$(c).css("height",Ie.sdScrollH+"px"),$(c).css("position","absolute")}("settingDlg","fontStyle",Re,o,a,Ie.sdFontStyleW),o+=Ie.sdFontStyleW+Ie.sdScrollGap,bt("settingDlg","fontSize",Ee,o,a,Ie.sdFontSizeW),a+=Ie.sdIconH+Ie.sdGroupGap),ht("settingDlg","sdLanguageIcon","setting_language.png",o=Ie.sdFrameGapX,a),o+=Ie.sdIconW+Ie.sdIconScrollGap,function(e,t,o,a,n,i){var r,c,s,d="";for(l(e,t),d="",r=0;r<o.length;r++)c=t+"-"+o[r][b.value],s=o[r][b.value],d+="<option"+(1===o[r][b.status]?' selected="true"':"")+' id="'+c+'">'+s+"</option>";$("#"+t).html(d),c="#"+t,$(c).css("top",n+(Ie.sdIconH-Ie.sdScrollH)/2+"px"),$(c).css("left",a+"px"),$(c).css("width",i+"px"),$(c).css("height",Ie.sdScrollH+"px"),$(c).css("position","absolute")}("settingDlg","sdLanguageFamily",Ae,o,a,Ie.sdFontFamilyW),vt(!1),un()}function ht(e,t,o,a,n){var i,r;c(e,t),i="#"+t,r=$n(o),$(i).css("background",r),$(i).css("top",n+"px"),$(i).css("left",a+"px"),$(i).css("width",Ie.sdIconW+"px"),$(i).css("height",Ie.sdIconH+"px"),$(i).css("position","absolute")}function bt(e,t,o,a,n,i){var r,c,s,d="";for(l(e,t),d="",r=0;r<o.length;r++)c=t+"-"+o[r][b.value],s=o[r][b.value],d+="<option"+(1===o[r][b.status]?' selected="true"':"")+' id="'+c+'">'+s+"</option>";$("#"+t).html(d),c="#"+t,$(c).css("top",n+(Ie.sdIconH-Ie.sdScrollH)/2+"px"),$(c).css("left",a+"px"),$(c).css("width",i+"px"),$(c).css("height",Ie.sdScrollH+"px"),$(c).css("position","absolute")}function vt(e){p("settingDlg",e)}function wt(){var e,t,o,n,i,r;e=Ie.tidFrameGap+Ie.tidTextFrmW+Ie.tidFrameGap,t=Ie.tidFrameGap+Ie.tidIconH+Ie.tidIconFrmGap+Ie.tidTextFrmH+Ie.tidFrameGap,o="#textInputDlg",$(o).css("top","calc(50% - "+(t-Ie.titleIconH)/2+"px)"),$(o).css("left","calc(50% - "+e/2+"px)"),$(o).css("width",e+"px"),$(o).css("height",t+"px"),$(o).css("position","absolute"),$(o).css("background",Ie.tidBkg),$(o).css("opacity",Ie.tidOpacity),c("textInputDlg","textInputClose"),o="#textInputClose",r=$n("yes.png"),n=e-Ie.tidFrameGap-Ie.tidIconW,i=Ie.tidFrameGap,$(o).css("background",r),$(o).css("top",i+"px"),$(o).css("left",n+"px"),$(o).css("width",Ie.tidIconW+"px"),$(o).css("height",Ie.tidIconH+"px"),$(o).css("position","absolute"),$(o).on("click",vo),a("textarea","textInputDlg","textInputArea"),o="#textInputArea",n=Ie.tidFrameGap,i=Ie.tidFrameGap+Ie.tidIconH+Ie.tidIconFrmGap,$(o).css("position","absolute"),$(o).css("resize","none"),$(o).css("top",i+"px"),$(o).css("left",n+"px"),$(o).css("width",Ie.tidTextFrmW+"px"),$(o).css("height",Ie.tidTextFrmH+"px"),$(o).css("padding","0px"),$(o).attr("cols",Ie.tidTextFrmW),$(o).attr("rows",Ie.tidTextFrmH),yt(!1)}function yt(e){p("textInputDlg",e),e&&setTimeout((function(){$("#textInputArea").focus()}),300)}function It(){return document.getElementById("textInputArea").value.length}function xt(){p("aboutDlg",!0)}function Ct(){p("aboutDlg",!1)}function $t(e,t,o,a,n,i,r){var c,l;c="#"+e,r&&(l=$n(t),$(c).css("background",l)),$(c).css("top",a+"px"),$(c).css("left",o+"px"),$(c).css("width",n+"px"),$(c).css("height",i+"px"),$(c).css("position","absolute")}function Bt(e,t,o,a,n){c(e,t),$t(t,o,a,n,Ie.pcdIconW,Ie.pcdIconH,!0)}function St(e,t,o,a,n){u(e,t),$t(t,!1,o,a+Ie.pcdUnitOffsetY,Ie.pcdUnitW,Ie.pcdUnitH,!1),$("#"+t).css("text-align","right"),function(e,t){e=document.getElementById(e),Bn(e,t)}(t,n)}function Wt(e,t,o,a,n){var i="#"+t;d(e,t),$t(t,!1,o,a,Ie.pcdTextW,Ie.pcdTextH,!1),$(i).keydown((function(e){-1!==$.inArray(e.keyCode,[46,8])||e.keyCode>=35&&e.keyCode<=40||(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault()})),$(i).attr("value",n),$(i).css("text-align","center")}function kt(e){p("periodicCaptureDlg",e)}function _t(){var e,t,o,a;a=Math.min(Ue+Xe,La-Ie.drawSetH),e=Ie.pcibTextW+Ie.pcibIconW,t=Ie.pcibIconH,o="#periodicCaptureInfoBar",$(o).css("position","absolute"),$(o).css("background",Ie.pcibBkg),$(o).css("opacity",Ie.pcibOpacity),$(o).css("left","calc(50% - "+e/2+"px)"),$(o).css("top",a-t-Ie.pcidGapY+"px"),$(o).css("width",e+"px"),$(o).css("height",t+"px")}function Tt(){Sa.capturePeriodRun=!1,Dt(!1)}function Dt(e){p("periodicCaptureInfoBar",e)}function Ht(){var e,t,o;e=2*Ie.cdFrameGap+2*Ie.cdIconW+Ie.cdIconGap,t=2*Ie.cdFrameGap+Ie.cdIconH,o="#confirmDlg",$(o).css("position","absolute"),$(o).css("background",Ie.cdBkg),$(o).css("opacity",Ie.cdOpacity),$(o).css("left","calc(50% - "+e/2+"px)"),$(o).css("top","calc(50% - "+t/2+"px)"),$(o).css("width",e+"px"),$(o).css("height",t+"px")}function Mt(){var e,t,o="confirmDlg",a=o+"_yes",n=o+"_no";function i(e,t,a,n){var i,r;c(o,e),i="#"+e,r=$n(t),$(i).css("background",r),$(i).css("left",a+"px"),$(i).css("top",n+"px"),$(i).css("width",Ie.cdIconW+"px"),$(i).css("height",Ie.cdIconH+"px"),$(i).css("position","absolute"),$(i).on("mousedown",(function(e){m.left===e.which&&($(i).css("background-color",Ie.cdMouseColorClick),function(e){var t,o="confirmDlg",a=o+"_yes";t=document.getElementById(o),t.clickHandler&&t.clickHandler(e==a)}(e.target.id))})).on("mousemove",(function(e){$(i).css("background-color",Ie.cdMouseColorEnter)})).on("mouseout",(function(){$(i).css("background-color",Ie.cdMouseColorLeave)}))}c("uiArea",o),Ht(),i(n,"no.png",e=Ie.cdFrameGap,t=Ie.cdFrameGap),i(a,"yes.png",e+=Ie.cdIconW+Ie.cdIconGap,t),Pt(!1)}function Pt(e){p("confirmDlg",e)}function zt(e){document.getElementById("confirmDlg").clickHandler=e}function Ft(){var e=nt.files;e.length&&-1!=e[0].type.indexOf("image")&&function(e){var t=new Image;if(t.addEventListener("load",(function(){e.name,t.width,t.height,e.type,Math.round(e.size/1024);fe(t)})),-1!=e.type.indexOf("tif")){var o=new FileReader;o.onload=function(e){var o=e.target.result,a=new Tiff({buffer:o}).toCanvas();a&&(t.src=a.toDataURL())},o.readAsArrayBuffer(e)}else t.src=window.URL.createObjectURL(e)}(e[0])}function Rt(){$("#imgInput").val(""),nt.click(),document.body.onfocus=function(){Vt&&setTimeout((function(){document.getElementById("importPictureWin").hidden&&attachCropBox(Ye,Xe)}),200),document.body.onfocus=null}}function At(){d("uiArea","imgInput"),(nt=document.getElementById("imgInput")).hidden=!0,nt.type="file",nt.accept=".jpg, .png, .jpeg, .bmp, .tif, .tiff|image/*",nt.onchange=Ft,Yn()}function Et(e,t,o,a){var n={x:0,y:0,w:0,h:0};return e*a<o*t?(n.w=e,n.x=0,n.h=Math.floor(n.w*a/o),n.y=Math.floor((t-n.h)/2)):(n.h=t,n.y=0,n.w=Math.floor(n.h*o/a),n.x=Math.floor((e-n.w)/2)),n}function Lt(e){var t;for(t=0;t<e.length;t++)e[t].fileEntrySub&&e[t].fileEntrySub.remove((function(){}),(function(){})),e[t].fileEntryOrg.remove((function(){}),(function(){})),$("#"+e[t].id).parent().remove();Yn()}async function Ot(e,t){if(0!=e.length&&!(Fn.length<=0)){for(var o=0;o<Fn.length;o++)if(Fn[o].name==e[0].fileName){var a;a=-1!=Fn[o].name.indexOf("mp4")||-1!=Fn[o].name.indexOf("webm")?URL.createObjectURL(Fn[o].video):Fn[o].normalImage;const e=document.createElement("a");e.href=a,e.download=Fn[o].name,document.body.appendChild(e),e.click(),document.body.removeChild(e),URL.revokeObjectURL(a);break}return}}$(document).on("webkitfullscreenchange",(function(){if(document.fullscreenElement)(it=document.fullscreenElement).style.border="none";else{var e=Ie.thumbFrmSize+"px solid "+Ie.thumbFrmColorChecked;it.style.border=e}}));var Yt=!1,Xt=!1,Gt=0,Ut=0;function Nt(e){Yt=e,window.onresize(),Sa.showToolBar=!Sa.showToolBar,Wa(Sa.showToolBar),function(){var e;e=Sa.showToolBar?"btnHideFunctionIcon":"btnShowFunctionIcon";Dn("sys_fullPhoto",e)}(),Ga()}function qt(e){switch(e.target.id){case"sys_close":if(ri)return pi(),void setTimeout((function(){qt(e)}),1e3);1==chrome.app.window.current().isFullscreen()&&document.webkitCancelFullScreen(),window.close();break;case"sys_fullScreen":return document.body.clientWidth>=window.screen.width&&document.body.clientHeight>=window.screen.height-50&&!Xt?($("#dialogSave").hasClass("ui-dialog-content")&&!0===$("#dialogSave").dialog("isOpen")&&$("#dialogSave").dialog("close"),document.webkitCancelFullScreen(),void window.resizeTo(840,660)):(Xt?($("#dialogSave").hasClass("ui-dialog-content")&&!0===$("#dialogSave").dialog("isOpen")&&$("#dialogSave").dialog("close"),window.resizeTo(Gt,Ut)):(Gt=document.body.clientWidth,Ut=document.body.clientHeight,window.resizeTo(window.screen.width,window.screen.height)),void(Xt=!Xt));case"sys_fullPhoto":Nt(!Yt);break;case"sys_smallScreen":if(ri||Sa.capturePeriodRun)return $("#dialogSave").hasClass("ui-dialog-content")&&!0===$("#dialogSave").dialog("isOpen")&&$("#dialogSave").dialog("close"),$("#dialogSave").dialog({title:"!",dialogClass:"no-close",autoOpen:!1,width:250,height:100,show:{effect:"fade",duration:500},buttons:{No:function(){$(this).dialog("close")},Yes:function(){ri&&pi(),Sa.capturePeriodRun&&Tt(),chrome.windows.update(appID,{state:"minimized"}),$(this).dialog("close")}},close:function(e,t){$(this).dialog("destroy")}}),$("#dialogSave").html("<br/>Minimizing the window will stop taking pictures or videos. Continue?<br/> "),void $("#dialogSave").dialog("open");chrome.app.window.current().minimize()}}var Vt=!1,jt=!1,Zt={freeze:!1,flip:!1,mirror:!1,zoomRatio:1,zoomX:0,zoomY:0,zoomW:0,zoomH:0,panWinW:0,panWinH:0,zoomScrollBarPos:0,previewRotate:0,canvas:null};function Kt(e){e.freeze=!1,e.flip=!1,e.mirror=!1,e.zoomRatio=1,e.zoomX=0,e.zoomY=0,e.zoomW=0,e.zoomH=0,e.panWinW=0,e.panWinH=0,e.zoomScrollBarPos=0,Sa.previewRotate=0}function Jt(e){if("mode_about"!=e.target.id){if(!$("#dialogSave").is(":visible")){if(ri)return $("#dialogSave").dialog({title:"!",dialogClass:"no-close",autoOpen:!1,width:250,height:100,show:{effect:"fade",duration:500},buttons:{No:function(){$(this).dialog("close")},Yes:function(){$(this).dialog("close"),pi(),setTimeout((function(){Jt(e)}),1e3)}},close:function(e,t){$(this).dialog("destroy")}}),$("#dialogSave").html("<br/>Will you stop recording?<br/> "),void $("#dialogSave").dialog("open");switch(Sa.curMode.baseId){case"playbackArea":"mode_about"!=e.target.id&&"mode_playback"!=e.target.id&&ca(Sa.curMode);break;case"previewArea":var t=Sa.curMode;if(1==Sa.capturePeriodRun)return $("#dialogSave").dialog({title:"!",dialogClass:"no-close",autoOpen:!1,width:250,height:100,show:{effect:"fade",duration:500},buttons:{No:function(){$(this).dialog("close")},Yes:function(){$(this).dialog("close"),Tt(),setTimeout((function(){Jt(e)}),500)}},close:function(e,t){$(this).dialog("destroy")}}),$("#dialogSave").html("<br/>Discard Interval Timer Shooting?<br/> "),void $("#dialogSave").dialog("open");if("mode_preview"!=e.target.id&&Tt(),!Vt&&!jt){if("mode_preview"==e.target.id)return;o=t,Zt.freeze=o.freeze,Zt.flip=o.flip,Zt.mirror=o.mirror,Zt.zoomRatio=o.zoomRatio,Zt.zoomX=o.zoomX,Zt.zoomY=o.zoomY,Zt.zoomW=o.zoomW,Zt.zoomH=o.zoomH,Zt.panWinW=o.panWinW,Zt.panWinH=o.panWinH,Zt.zoomScrollBarPos=o.zoomScrollBarPos,Zt.previewRotate=Sa.previewRotate,null==Zt.canvas&&(Zt.canvas=document.createElement("canvas")),Zt.canvas.width=o.baseImageCanvas.width,Zt.canvas.height=o.baseImageCanvas.height,Zt.canvas.getContext("2d").drawImage(o.baseImageCanvas,0,0),$("#captureHit").hide()}if(Vt&&(wo=!1,Ja(t),$("#displayCanvas").css("transform","scale(1,1)"),M("scanToolBarS2",0),Kt(Wo)),jt&&xo.length)return $("#dialogSave").hasClass("ui-dialog-content")&&!0===$("#dialogSave").dialog("isOpen")&&$("#dialogSave").dialog("close"),$("#dialogSave").dialog({title:"!",dialogClass:"no-close",autoOpen:!1,width:250,height:100,show:{effect:"fade",duration:500},buttons:{No:function(){$(this).dialog("close")},Yes:function(){xo=[],Bo(),$(this).dialog("close"),setTimeout((function(){Jt(e)}),300)}},close:function(e,t){$(this).dialog("destroy")}}),$("#dialogSave").html("<br/>Discard captured images?<br/> "),void $("#dialogSave").dialog("open");t.imageProcess&&t.imageProcess(),removeCropBox(),Vt=!1,jt=!1;break;case"drawingArea":M("drawingToolBar",0),Sa.fnDraw=null}var o;switch(e.target.id){case"mode_preview":!function(e){e.freeze=Zt.freeze,e.flip=Zt.flip,e.mirror=Zt.mirror,e.zoomRatio=Zt.zoomRatio,e.zoomX=Zt.zoomX,e.zoomY=Zt.zoomY,e.zoomW=Zt.zoomW,e.zoomH=Zt.zoomH,e.panWinW=Zt.panWinW,e.panWinH=Zt.panWinH,e.zoomScrollBarPos=Zt.zoomScrollBarPos,Sa.previewRotate=Zt.previewRotate}(Wo),ka(Wo),Zt.freeze&&(!function(e){null!=Zt.canvas&&(e.baseImageContext.drawImage(Zt.canvas,0,0),e.imageProcess())}(Wo),Wo.imageProcess());break;case"mode_playback":na.curMode!=aa.image&&Yn(),ka(na);break;case"mode_drawingBoard":ka(xa);break;case"mode_about":dn("mode_about",xt,Ct);break;case"mode_scan":Vt=!0,Ja(Wo),Kt(Wo),Wo.imageProcess(),ka(Wo),eo(),ct(Sa.curMode.lToolBar,!1),ct(Sa.curMode.rToolBar,!1),ct(Sa.curMode.bToolBar,!1),ct(Sa.curMode.lS1ToolBar,!0),ct(Sa.curMode.lS2ToolBar,!1),ct(Sa.curMode.lMsToolBar,!1),yo=!1,attachCropBox(Ye,Xe,!0),M("scanToolBarS1",0);break;case"mode_multiscan":jt=!0,Kt(Wo),ka(Wo),eo(),ct(Sa.curMode.lToolBar,!1),ct(Sa.curMode.rToolBar,!1),ct(Sa.curMode.bToolBar,!1),ct(Sa.curMode.lMsToolBar,!0),ct(Sa.curMode.lS1ToolBar,!1),ct(Sa.curMode.lS2ToolBar,!1),yo=!1,attachCropBox(Ye,Xe,!0),M("multiscanToolBar",0),xo.length?$o():Bo()}D(e)}}else dn("mode_about",xt,Ct)}if(void 0===Qt)var Qt={id:0,fn:1};function eo(){M("drawingToolBar",0),Sa.fnDraw=null}function to(e){var t,o=[["btn_freehand",ro],["btn_arrow",co],["btn_eraser",so],["btn_line",uo],["btn_rectangleLine",po],["btn_rectangle",go],["btn_circleLine",mo],["btn_circle",fo],["btn_text",ho]],a=Sa.curMode;if("btn_erase_all"==e.target.id)ja(a.drawingCanvas),Ka(a),a.imageProcess&&a.imageProcess(),ln();else if("btn_configDraw"==e.target.id)$("#configDrawDlg").toggle(500);else if("sys_fullPhoto"==e.target.id)Nt(!Yt);else{for(t=0;t<o.length;t++)e.target.id==o[t][Qt.id]&&(Sa.fnDraw==o[t][Qt.fn]?Sa.fnDraw=void 0:Sa.fnDraw=o[t][Qt.fn]);ln()}D(e)}function oo(e,t,o,a){var n={x:0,y:0,w:0,h:0,centerX:0,centerY:0,endX:0,endY:0,regularX:0,regularY:0,regularSide:0};return n.x=Math.min(e,o),n.y=Math.min(t,a),n.w=Math.abs(o-e),n.h=Math.abs(a-t),n.centerX=n.x+n.w/2,n.centerY=n.y+n.h/2,n.endX=n.x+n.w,n.endY=n.y+n.h,n.regularX=n.x,n.regularY=n.y,n.w>n.h?(n.regularSide=n.h,n.regularX!==e&&(n.regularX=e-n.regularSide)):(n.regularSide=n.w,n.regularY!==t&&(n.regularY=t-n.regularSide)),n}function ao(e,t,o,a,n){var i,r;t=(i=oo(t,o,a,n)).x,o=i.y,r=i.centerX,i.centerY,a=i.endX,n=i.endY,e.moveTo(r,o),e.bezierCurveTo(a,o,a,n,r,n),e.bezierCurveTo(t,n,t,o,r,o)}var no=0,io=new Array;function ro(e){var t=Sa.drawContext;switch(e){case f.start:Za(),t.strokeStyle=Sa.drawStyle,t.lineWidth=Sa.lineWidth,io.push({x:Sa.drawStartX,y:Sa.drawStartY}),io.push({x:Sa.drawStartX,y:Sa.drawStartY}),io.push({x:Sa.drawStartX,y:Sa.drawStartY});break;case f.move:if(0==io.length)return;if((n=new Date).getTime()-no<10)break;no=n.getTime(),io.push({x:Sa.drawCurX,y:Sa.drawCurY}),t.clearRect(0,0,Sa.drawCanvas.width,Sa.drawCanvas.height),t.moveTo(io[0].x,io[0].y),t.beginPath();for(var o=1;o<io.length-2;o++){var a=(io[o].x+io[o+1].x)/2,n=(io[o].y+io[o+1].y)/2;t.quadraticCurveTo(io[o].x,io[o].y,a,n)}t.quadraticCurveTo(io[o].x,io[o].y,io[o+1].x,io[o+1].y),t.stroke();break;case f.end:io=[]}}function co(e){switch(e){case f.start:break;case f.move:Za();var t={x:Sa.drawStartX,y:Sa.drawStartY},o={x:Sa.drawCurX,y:Sa.drawCurY},a=function(e,t,o){var a={end1:{x:0,y:0},end2:{x:0,y:0}},n=t.x-e.x,i=t.y-e.y,r=Math.sqrt(n*n+i*i),c=n/r,l=i/r;return a.end1.x=t.x-c*o-l*o,a.end1.y=t.y-l*o+c*o,a.end2.x=t.x-c*o+l*o,a.end2.y=t.y-l*o-c*o,a}(t,o,Math.max(2*Sa.lineWidth,Ie.minArrowSize)),n=Sa.drawContext;n.fillStyle=Sa.drawStyle,n.strokeStyle=Sa.drawStyle,n.lineWidth=Sa.lineWidth,n.beginPath(),n.moveTo(t.x,t.y),n.lineTo((a.end1.x+a.end2.x)/2,(a.end1.y+a.end2.y)/2),n.closePath(),n.stroke(),n.moveTo(o.x,o.y),n.lineTo(a.end1.x,a.end1.y),n.lineTo(a.end2.x,a.end2.y),n.closePath(),n.fill();case f.end:}}function lo(e,t,o,a,n){var i,r;i=t-a/2,r=o-a/2,void 0===n?(i-=1,r-=1,a+=2,e.clearRect(i-1,r-1,a+2,a+2)):(e.beginPath(),e.strokeStyle=n,e.fillStyle=n,e.lineWidth=0,e.rect(i,r,a,a),e.fill(),e.stroke())}function so(e){var t=Sa.baseContext,o=2*Sa.lineWidth;switch(o<10&&(o=10),e){case f.start:Za(),lo(t,Sa.drawCurX,Sa.drawCurY,o,Sa.eraserStyle);break;case f.move:lo(t,Sa.drawLastX,Sa.drawLastY,o),lo(t,Sa.drawCurX,Sa.drawCurY,o,Sa.eraserStyle);break;case f.end:lo(t,Sa.drawCurX,Sa.drawCurY,o)}}function uo(e){switch(e){case f.start:break;case f.move:Za();var t=Sa.drawContext;t.strokeStyle=Sa.drawStyle,t.lineWidth=Sa.lineWidth,t.beginPath(),t.moveTo(Sa.drawStartX,Sa.drawStartY),t.lineTo(Sa.drawCurX,Sa.drawCurY),t.stroke();case f.end:}}function po(e){switch(e){case f.start:break;case f.move:Za();var t,o=Sa.drawContext;o.strokeStyle=Sa.drawStyle,o.lineWidth=Sa.lineWidth,t=oo(Sa.drawStartX,Sa.drawStartY,Sa.drawCurX,Sa.drawCurY),o.beginPath(),Sa.drawRegularShape?o.rect(t.regularX,t.regularY,t.regularSide,t.regularSide):o.rect(t.x,t.y,t.w,t.h),o.stroke();case f.end:}}function go(e){switch(e){case f.start:break;case f.move:Za();var t,o=Sa.drawContext;o.fillStyle=Sa.drawStyle,o.strokeStyle=Sa.clearStyle,o.lineWidth=0,t=oo(Sa.drawStartX,Sa.drawStartY,Sa.drawCurX,Sa.drawCurY),Sa.drawRegularShape?o.rect(t.regularX,t.regularY,t.regularSide,t.regularSide):o.rect(t.x,t.y,t.w,t.h),o.fill();case f.end:}}function mo(e){switch(e){case f.start:break;case f.move:var t,o=Sa.drawContext;Za(),o.strokeStyle=Sa.drawStyle,o.lineWidth=Sa.lineWidth,o.beginPath(),Sa.drawRegularShape?ao(o,(t=oo(Sa.drawStartX,Sa.drawStartY,Sa.drawCurX,Sa.drawCurY)).regularX,t.regularY,t.regularX+t.regularSide/3*4,t.regularY+t.regularSide):ao(o,Sa.drawStartX,Sa.drawStartY,Sa.drawCurX,Sa.drawCurY),o.closePath(),o.stroke();case f.end:}}function fo(e){switch(e){case f.start:break;case f.move:var t,o=Sa.drawContext;Za(),o.fillStyle=Sa.drawStyle,Sa.drawRegularShape?ao(o,(t=oo(Sa.drawStartX,Sa.drawStartY,Sa.drawCurX,Sa.drawCurY)).regularX,t.regularY,t.regularX+t.regularSide/3*4,t.regularY+t.regularSide):ao(o,Sa.drawStartX,Sa.drawStartY,Sa.drawCurX,Sa.drawCurY),o.fill();case f.end:}}function ho(e){switch(e){case f.start:0==Sa.drawText&&dn("textInputDlg",bo,null);break;case f.move:break;case f.end:0==Sa.drawText&&It()&&an(f.end)}}function bo(){var e,t;t="rgb("+Sa.colorR+","+Sa.colorG+","+Sa.colorB+")",e="#textInputArea",$(e).css("font",Ie.tidTextSize+"px "+Sa.fontFamily),$(e).css("color",t),-1!=Sa.fontStyle.indexOf("Bold")?($(e).css("font-weight","bold"),Sa.fontBold=!0):($(e).css("font-weight","normal"),Sa.fontBold=!1),-1!=Sa.fontStyle.indexOf("Italic")?($(e).css("font-style","italic"),Sa.fontItalic=!0):($(e).css("font-style","normal"),Sa.fontItalic=!1),document.getElementById("textInputArea").value="",Sa.drawFontStyle=Sa.drawStyle,Sa.drawing=!1,Sa.drawText=!0,yt(!0)}function vo(){yt(!1),Za(),function(){if(0==It())return;const e=Sa.drawStartX,t=Sa.drawStartY,o=Sa.fontSize,a=Sa.drawContext,n=document.getElementById("textInputArea").value;let i="";Sa.fontBold&&(i+="Bold ");Sa.fontItalic&&(i+="Italic ");a.fillStyle=Sa.drawFontStyle,a.strokeStyle=Sa.drawStyle,a.font=i+o+"pt "+Sa.fontFamily;const r=n.split("\n"),c=1.5*o;r.forEach(((o,n)=>{a.fillText(o,e,t+n*c)}))}(),Sa.drawText=!1,Sa.fnDraw&&Sa.fnDraw(f.end)}var wo=!1,yo=!1;async function Io(e){var t,o,a,n,i,r=Wo;switch(e.target.id){case"scbtn_importPic":ve(!1),removeCropBox(),Rt();break;case"scbtn_fullcrop":yo?attachCropBox(Ye,Xe,!0):attachCropBoxFull(Ye,Xe),yo=!yo;break;case"scbtn_transform":if(0==$("#cropBox").length)return;o=ma(),a=o.width,n=o.height,i=new Image,Sa.curMode.freeze=!0,i.width=a,i.height=n,i.src=o.toDataURL(),i.onload=function(){var e=Sa.curMode,t=e.baseImageContext,o=e.imgW/a,r=e.imgH/n;Za(),t.beginPath(),t.rect(0,0,e.imgW,e.imgH),t.fillStyle="black",t.fill(),a/n>=e.imgW/e.imgH?t.drawImage(i,0,(e.imgH-n*o)/2,e.imgW,n*o):t.drawImage(i,(e.imgW-a*r)/2,0,a*r,e.imgH),an(f.end),e.imageProcess&&e.imageProcess()},removeCropBox(),Ja(r),ct(Sa.curMode.lS1ToolBar,!1),ct(Sa.curMode.rToolBar,!0),ct(Sa.curMode.bToolBar,!0),ct(Sa.curMode.lS2ToolBar,!0),wo=!0;break;case"scbtn_preview":!function(){var e=Wo;e.freeze=!1,removeCropBox(),Ja(e),ja(document.getElementById("previewArea-combineCanvas")),Za(),function(){var e=document.getElementById("displayCanvas");e.width+=0}(),e.imageProcess&&e.imageProcess();yo?attachCropBoxFull(Ye,Xe):attachCropBox(Ye,Xe);ct(Sa.curMode.lS2ToolBar,!1),ct(Sa.curMode.rToolBar,!1),ct(Sa.curMode.bToolBar,!1),ct(Sa.curMode.lS1ToolBar,!0),M("scanToolBarS2",0),e.mirror=!1,e.flip=!1,wo=!1}();break;case"scbtn_mirrow":r.mirror=!r.mirror,an(f.mirror);break;case"scbtn_flip":r.flip=!r.flip,an(f.flip);break;case"scbtn_config":ln(),$("#configDlg").toggle(500);break;case"scbtn_setting":dn("btn_setting",jo,Zo);break;case"scbtn_ocr":t={launch:!0,senderName:we},chrome.runtime.sendMessage(OcrAppID,t,(function(e){if(chrome.runtime.lastError)return $("#dialogOcr").dialog({dialogClass:"no-close",autoOpen:!1,width:250,height:140,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500},buttons:{"Add it now":function(){var e=OcrAppLink;window.open(e),$(this).dialog("close")},Later:function(){$(this).dialog("close")}}}),$("#dlgOcrTxt").text("This feature requires installing a free OCR extension from the Chrome Web Store."),void $("#dialogOcr").dialog("open");document.getElementById("previewArea-combineCanvas").toBlob((function(e){setTimeout((function(){fa(e)}),200)}))}));break;case"scbtn_saveDisk":Po(),hn(r.combineCanvas);break;case"scbtn_redo":case"scbtn_redo2":an(f.redo);break;case"scbtn_undo":an(f.undo);break;case"scbtn_undo2":if(1==r.canvasStep)return;an(f.undo)}D(e)}var xo=[];function Co(e=null){$("#dialogSave").dialog({dialogClass:"no-close",autoOpen:!1,width:250,height:80,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500},buttons:{JPG:function(){$(this).dialog("close"),async function(e){var t=mn("");if(Sa.lastSaveFilename==t)return;for(var o=0;o<e.length;o++)hn(e[o],t+"-"+o)}(xo),xo=[],e&&Jt(e),Bo()},PDF:function(){$(this).dialog("close"),async function(e){for(var t=mn(""),o=-1,a=-1,n=0;n<e.length;n++)e[n].width>o&&(o=e[n].width),e[n].height>a&&(a=e[n].height);for(var i=new jsPDF({orientation:o>a?"l":"p",unit:"pt",format:[o,a]}),r=0;r<e.length;r++){var c=(o-e[r].width)/2,l=(a-e[r].height)/2;r>0&&i.addPage();var s=await e[r].toDataURL("image/jpeg",1);await i.addImage(s,"JPEG",c,l,e[r].width,e[r].height)}i.save(t+".pdf")}(xo),xo=[],e&&Jt(e),Bo()},X:function(){$(this).dialog("close")}},close:function(e,t){$(this).dialog("destroy")}}),$("#dialogSave").html(""),$("#dialogSave").dialog("open")}function $o(e=""){$("#lbMsCnt").text(e),$("#lbMsCnt").show(),$("#mscbtn_cancel").show()}function Bo(){$("#lbMsCnt").hide(),$("#mscbtn_cancel").hide()}function So(e){var t,o,a,n=Wo;switch(e.target.id){case"mscbtn_capture":if(0==$("#cropBox").length||0==wi)return;$("#dialogSave").is(":visible")&&$("#dialogSave").dialog("close");var i=ma();xo.push((t=i,o=document.createElement("canvas"),a=o.getContext("2d"),o.width=t.width,o.height=t.height,a.drawImage(t,0,0),o)),0==$("#lbMsCnt").length&&(u("uiArea","lbMsCnt"),$("#lbMsCnt").addClass("MultiScanCnt"),$("#lbMsCnt").css({top:La-80,left:Ea/2,position:"absolute"})),$o(xo.length),n.imageProcess&&n.imageProcess();break;case"mscbtn_merge":if(0==xo.length)return $("#dialogSave").dialog({dialogClass:"no-close",title:"!",autoOpen:!1,width:250,height:100,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500},buttons:{OK:function(){$(this).dialog("close")}},close:function(e,t){$(this).dialog("destroy")}}),$("#dialogSave").html("<br>Please take pictures first."),void $("#dialogSave").dialog("open");Co();break;case"mscbtn_cancel":if(xo.length)return $("#dialogSave").dialog({title:"!",dialogClass:"no-close",autoOpen:!1,width:250,height:100,show:{effect:"fade",duration:500},buttons:{No:function(){$(this).dialog("close")},Yes:function(){xo=[],Bo(),$(this).dialog("close")}},close:function(e,t){$(this).dialog("destroy")}}),$("#dialogSave").html("<br/>Discard captured images?<br/> "),void $("#dialogSave").dialog("open");break;case"mscbtn_fullcrop":yo?attachCropBox(Ye,Xe,!0):attachCropBoxFull(Ye,Xe),yo=!yo}n.mirror&&n.flip?$("#displayCanvas").css("transform","scale(-1,-1)"):!n.mirror&&n.flip?$("#displayCanvas").css("transform","scale(1,-1)"):n.mirror&&!n.flip?$("#displayCanvas").css("transform","scale(-1,1)"):n.mirror||n.flip||$("#displayCanvas").css("transform","scale(1,1)"),D(e)}var Wo={baseId:"previewArea",lToolBar:"previewToolBar",lS1ToolBar:"scanToolBarS1",lS2ToolBar:"scanToolBarS2",lMsToolBar:"multiscanToolBar",rToolBar:"drawingToolBar",bToolBar:"drawingCfgArea",taskCtrl:function(e){var t=Wo;e?(t.panMove=!1,Sa.capturePeriodRun&&Dt(!0),t.zoomRatio>1&&Tn(!0)):(ve(!1),Dt(!1),Tn(!1))},start:function(){ko()},init:function(){var e=Wo;fi=e.imgW=Sa.reqImgW,hi=e.imgH=Sa.reqImgH,et(e,fi,hi),tt(e),Qa(e),function(){function e(e,t){var o,a,n,i,r=Sa.curMode,c=r.panWinW/r.imgW;return o=r.zoomX*c,a=r.zoomY*c,n=r.zoomW*c,i=r.zoomH*c,e>=o&&e<=o+n&&t>=a&&t<=a+i}$("#cropWin").on("mousedown",(function(t){e(t.offsetX,t.offsetY)&&(Sa.panMove=!0,Sa.panMoveX=t.offsetX,Sa.panMoveY=t.offsetY)})).on("mousemove",(function(e){Sa.panMove&&function(e,t){var o=Sa.curMode,a=o.imgW/o.panWinW;o.zoomX+=(e-Sa.panMoveX)*a,o.zoomY+=(t-Sa.panMoveY)*a,o.zoomX=Math.max(o.zoomX,0),o.zoomY=Math.max(o.zoomY,0),o.zoomX+o.zoomW>o.imgW&&(o.zoomX=o.imgW-o.zoomW);o.zoomY+o.zoomH>o.imgH&&(o.zoomY=o.imgH-o.zoomH);_n(),an(f.pan),Sa.panMoveX=e,Sa.panMoveY=t}(e.offsetX,e.offsetY)})).on("mouseup",(function(e){Sa.panMove=!1})).on("mouseout",(function(e){Sa.panMove=!1})).on("touchstart",(function(e){Ra(e)})).on("touchmove",(function(e){Ra(e)})).on("touchend",(function(){Ra(event)})).on("touchcancel",(function(){Ra(event)}))}(),Tn(!1),Ta(e,!1)},onResize:ko,canvasCtrl:function(e){var t=Wo;switch(e){case f.start:return!1;case f.move:t.hasTempDraw=!0;break;case f.end:0==Sa.drawText&&(t.hasTempDraw=!1,t.mergeTempDraw=!0);break;case f.undo:t.canvasStep>0&&(t.reqUndo=!0);break;case f.redo:t.canvasStep<t.canvasArray.length-1&&(t.reqRedo=!0)}return!t.freeze},imageProcess:Xo,chgBaseImgCtrl:async function(e,t,o){var a=Wo;switch(e){case v.before:a.zoomRatio=1,Tn(!1),a.freeze=!1,H("previewToolBar","btn_freeze",0),await Fi(),fi=a.imgW=t,hi=a.imgH=o;break;case v.after:await zi()}},imgW:Ie.defPreviewRsoX,imgH:Ie.defPreviewRsoY,freeze:!1,hasTempDraw:!1,mergeTempDraw:!1,reqUndo:!1,reqRedo:!1,flip:!1,mirror:!1,zoomRatio:1,zoomX:0,zoomY:0,zoomW:Ie.defPreviewRsoX,zoomH:Ie.defPreviewRsoY,panWinW:0,panWinH:0,zoomScrollBarPos:0};function ko(){Wo.freeze&&Da(),!Vt&&!jt||wo||(removeCropBox(),attachCropBox(Ye,Xe)),kn(),_n(),_t()}async function _o(e){var t=Wo;switch(e.target.id){case"btn_freeze":t.freeze=!t.freeze;break;case"btn_undo":an(f.undo);break;case"btn_redo":an(f.redo);break;case"btn_mirrow":t.mirror=!t.mirror,t.zoomX=t.imgW-t.zoomX-t.zoomW,_n(),an(f.mirror);break;case"btn_flip":t.flip=!t.flip,t.zoomY=t.imgH-t.zoomY-t.zoomH,_n(),an(f.flip);break;case"btn_config":$("#configDlg").toggle(500);break;case"btn_brightness":dn("btn_brightness",Uo,No);break;case"btn_whitebalance":dn("btn_whitebalance",qo,Vo);break;case"btn_zoom":$("#configDlg").hide(),$("#zoomDlg").toggle(500);break;case"btn_setting":dn("btn_setting",jo,Zo);break;case"btn_capture":if(void 0===window.stream||!window.stream.active||!wi)break;hn(t.combineCanvas),$("#captureHit").css({position:"absolute",top:"60px",left:Ea/2-20+"px"}),$("#captureHit").show(100),Ho=1500,null==Do&&(Do=setInterval(Mo,500));break;case"btn_timesave":if(void 0===window.stream||!window.stream.active||!wi)break;0==Sa.capturePeriodRun&&dn("btn_timesave",Qo,Jo);break;case"btn_importPic":Rt();break;case"btn_record":if(void 0===window.stream||!window.stream.active||!wi)break;$("#dialogSave").hasClass("ui-dialog-content")&&!0===$("#dialogSave").dialog("isOpen")&&$("#dialogSave").dialog("close"),Sa.capturePeriodRun&&Tt(),Ja(t),(t.flip||t.mirror)&&(t.flip=!1,t.mirror=!1,_n(),an(f.flip),an(f.mirror),H("previewToolBar","btn_flip",0),H("previewToolBar","btn_mirrow",0)),t.zoomRatio>1&&Sn(),t.freeze&&(t.freeze=!1,H("previewToolBar","btn_freeze",0)),ri?pi():async function(){di=function(){return"orientation"in screen?screen.orientation.angle||0:"orientation"in window&&window.orientation||0}(),ui=fi,ri||(ri=!0,ln(),$("#btn_pause").show());ci=!1,si(!1),document.getElementById("recordtime").style.fontSize="18px",document.getElementById("recordtime").style.fontWeight="bold",document.getElementById("recordtime").style.color="red",document.getElementById("recordtime").style.position="absolute",document.getElementById("recordtime").style.top="159px",document.getElementById("recordtime").style.left="72px",document.getElementById("recordtime").style.visibility="visible";let e=new Date;ei=e.getTime(),oi=0,mi();const t=await navigator.mediaDevices.getUserMedia({audio:{deviceId:{exact:xi.deviceId}}});let o,a=window.stream;ai=t&&t.getTracks()?new MediaStream([...a.getTracks(),...t.getTracks()]):new MediaStream(a.getTracks());ii=[],MediaRecorder.isTypeSupported('video/webm; codecs="vp9, opus"')?(o='video/webm; codecs="vp9, opus"',ni="webm"):MediaRecorder.isTypeSupported('video/webm; codecs="vp8, vorbis"')?(o='video/webm; codecs="vp8, vorbis"',ni="webm"):MediaRecorder.isTypeSupported("video/webm")?(o="video/webm",ni="webm"):MediaRecorder.isTypeSupported("video/mp4")&&(o="video/mp4",ni="mp4");(Zn=new MediaRecorder(ai,{audioBitsPerSecond:96e3,videoBitsPerSecond:5e6,mimeType:o})).ondataavailable=e=>{e.data.size>0&&ii.push(e.data)},Zn.onstop=()=>{!async function(){var e=mn(ni);if("mp4"==ni){let t=new Blob(ii,{type:"video/mp4"});cr(t,e),ii=[],t=null}else if("webm"==ni){let t=new Blob(ii,{type:"video/webm"});setTimeout((function(){ysFixWebmDuration(t,ti,(async function(o){cr(o,e),ii=[],t=null}))}),100)}}(),ai.getAudioTracks().forEach((function(e){e.stop()}))},Zn.start(1e3)}();break;case"btn_pause":ri&&(ci?(clearInterval(To),function(){ci=!1,Zn.resume();var e=new Date;ei=e.getTime(),mi()}()):(To=setInterval(Fo,2e3),function(){ci=!0,Zn.pause();var e=(new Date).getTime();oi+=e-ei}()));break;case"btn_test":chrome.windows.getCurrent((function(e){chrome.windows.update(e.id,{state:"minimized"})}))}D(e)}var To,Do=null,Ho=0;function Mo(){(Ho-=500)<=0&&($("#captureHit").hide(150),clearInterval(Do),Do=null)}function Po(){$("#SaveHit").css({position:"absolute",top:"60px",left:Ea/2-20+"px"}),$("#SaveHit").show(100),Ho=1500,null==Do&&(Do=setInterval(zo,500))}function zo(){(Ho-=500)<=0&&($("#SaveHit").hide(150),clearInterval(Do),Do=null)}function Fo(){$("#recordtime").fadeOut(500),$("#recordtime").fadeIn(500)}function Ro(e,t){var o=Wo;e.drawImage(t,0,0,o.imgW,o.imgH)}var Ao=["1","0","0","0","0","0","1","0","0","0","0","0","1","0","0","0","0","0","1","0"],Eo=document.createElement("canvas"),Lo=!1;function Oo(e){var t=Wo;t.freeze&&!Lo&&(Eo.width=Wo.imgW,Eo.height=Wo.imgH,Eo.getContext("2d").drawImage(e,0,0));if(Lo=t.freeze,function(){var e,t;if(0!=Sa.frameRateInit){var o=new Date,a=o-Sa.frameLastTime,n=Sa.frameSlotIdx%Sa.frameCnt;for(Sa.frameLastTime=o,Sa.frameInterval[n]=a,t=0,e=0;e<Sa.frameCnt;e++)t+=Sa.frameInterval[e];Sa.frameRate=1e3*Sa.frameCnt/t,Sa.frameRate=Sa.frameRate.toFixed(2),0==n&&xn(),Sa.frameSlotIdx=n+1}else for(Sa.frameRateInit=!0,Sa.frameLastTime=new Date,Sa.frameSlotIdx=Sa.frameCnt,e=0;e<Sa.frameCnt;e++)Sa.frameInterval[e]=0}(),!t.freeze||!Vt){Ao[0]=1+Sa.previewBrightnessAdj/100+Sa.previewWhiteBalanceAdj/100,Ao[6]=1+Sa.previewBrightnessAdj/100,Ao[12]=1+Sa.previewBrightnessAdj/100-Sa.previewWhiteBalanceAdj/100;var o="",a=document.querySelector("#filter feColorMatrix");null!=a&&(Ao.forEach((e=>o+=e+" ")),a.setAttribute("values",o),t.baseImageContext.filter="url(#filter)"),t.freeze?Ro(t.baseImageContext,Eo):Ro(t.baseImageContext,e),Xo()}}var Yo=0;function Xo(){var e=Wo,t=e.imageProcessContext,o=1,a=1,n=0,i=0;e.mirror&&(o=-1,n=e.imgW),e.flip&&(a=-1,i=e.imgH),0==Sa.previewRotate?(t.save(),t.translate(n,i),t.scale(o,a),Ro(e.imageProcessContext,e.baseImageCanvas),t.restore(),Yo=0):(Sa.previewRotate!=Yo&&(t.fillStyle="black",t.fillRect(0,0,e.imgW,e.imgH)),t.save(),t.translate(e.imgW/2,e.imgH/2),t.rotate(Math.PI/180*Sa.previewRotate),t.scale(o,a),t.drawImage(e.baseImageCanvas,-e.imgW/2,-e.imgH/2,e.imgW,e.imgH),t.restore(),Yo=Sa.previewRotate),function(){var e=Wo;e.reqUndo?(e.reqUndo=!1,rn(e)):e.reqRedo?(e.reqRedo=!1,cn(e)):function(){var e=Wo;1==e.zoomRatio?Ro(e.combineContext,e.imageProcessCanvas):e.combineContext.drawImage(e.imageProcessCanvas,e.zoomX,e.zoomY,e.zoomW,e.zoomH,0,0,e.imgW,e.imgH);if(1===Ie.disableDrawingCanvasOverlay)return void Go();e.mergeTempDraw&&(e.mergeTempDraw=!1,e.drawingContext.drawImage(e.tempDrawingCanvas,0,0,e.imgW,e.imgH,0,0,e.imgW,e.imgH),Ka(e));e.combineContext.drawImage(e.drawingCanvas,0,0,e.imgW,e.imgH,0,0,e.imgW,e.imgH),function(){var e=Wo;e.hasTempDraw&&e.combineContext.drawImage(e.tempDrawingCanvas,0,0,e.imgW,e.imgH,0,0,e.imgW,e.imgH);Go()}()}()}()}function Go(){_a(Wo)&&Da()}function Uo(){ut(!0)}function No(){ut(!1)}function qo(){pt(!0)}function Vo(){pt(!1)}function jo(){vt(!0)}function Zo(){vt(!1),un(),async function(){const e=document.getElementById(Sa.idVideoinputSelect);if(!Ii)return;if(Ii.deviceId!=e.value){await Fi();const t=e.options[e.selectedIndex];Ii=t.device,await zi()}}(),En()}function Ko(){ln()}function Jo(){kt(!1)}function Qo(){kt(!0)}function ea(){var e;ln(),Sa.capturePeriodSec=document.getElementById("periodicCaptureDlg_periodText").value,Sa.captureIntervalHour=document.getElementById("periodicCaptureDlg_intervalText").value,Sa.capturePeriodSec<1||(e=60*Sa.captureIntervalHour/Sa.capturePeriodSec,e=Math.floor(e),Sa.capturePeriodTotalCnt=e,Sa.capturePeriodTotalCnt&&(Sa.capturePeriodRun=!0,Sa.capturePeriodCurCnt=0,Sa.capturePeriodMs=1e3*Sa.capturePeriodSec,oa(),Dt(!0)))}var ta=null;function oa(){var e=Wo;if(null==ta&&(ta=document.createElement("canvas")),Sa.capturePeriodCurCnt>=Sa.capturePeriodTotalCnt)return Sa.capturePeriodRun=!1,void Dt(!1);if(0!=Sa.capturePeriodRun){var t;hn(e.combineCanvas)&&(Sa.capturePeriodCurCnt+=1,t=Sa.capturePeriodCurCnt+" / "+Sa.capturePeriodTotalCnt,Bn(document.getElementById("periodicCaptureInfoBar_text"),t),Sa.capturePeriodCurCnt>=Sa.capturePeriodTotalCnt&&(Sa.capturePeriodMs=1e3)),setTimeout((function(){oa()}),Sa.capturePeriodMs)}}if(void 0===aa)var aa={thumbnail:0,image:1};var na={baseId:"playbackArea",lToolBar:"thumbnailToolBar",rToolBar:"playbackRToolBar",bToolBar:"playbackInfoBar",taskCtrl:function(e){e?en(!1):(ve(!1),en(!0),Tn(!1))},start:function(){var e=na;e.curMode==aa.image?(va(),en(!0),e.zoomRatio>1&&(kn(),_n(),Tn(!0))):(e.zoomScrollBarPos=0,e.zoomRatio=1)},init:function(){var e=na;tt(e),Qa(e),function(){r("playbackArea","thumbDiv");var e=Ie.toolBarIconW,t=Ie.toolBarIconH,o=Ie.titleIconH,a={position:"absolute",left:e+"px",top:o+"px",width:"calc(100% - "+2*e+"px)",height:"calc(100% - "+(o+t)+"px)","text-align":"center",overflow:"auto","user-select":"none"};$("#thumbDiv").css(a)}(),function(){var e="playbackInfoBar",t="#"+e;c("uiArea",e);var o={top:"calc(100% - "+Ie.toolBarIconH+"px)",left:Ie.toolBarIconW+"px",height:ye.iconH+"px",width:"calc(100% - "+2*Ie.toolBarIconW+"px)",background:Ie.toolBarColorLeave,opacity:Ie.toolBarOpacityLeave,position:"absolute"};$(t).css(o),p(e,!1),u(e,"pbFileInfo_Page"),u(e,"pbFileInfo_Item"),t="#"+(e="pbFileInfo_Text"),o.top=(ye.iconH-Ie.pbInfoH)/2+"px",o.left="calc(40% - "+Ie.pbInfoW/2+"px)",o.height=Ie.pbInfoH,o.width=Ie.pbInfoW/2,$(t).css(o),$(t).css("line-height",Ie.pbInfoH+"px"),$(t).css("font-size",Ie.pbInfoFontSize),$(t).css("font-weight",Ie.pbInfoFontWWeight),$(t).css("color",Ie.pbInfoColor_Page),$(t).css("text-align","left"),t="#"+(e="pbFileInfo_Page"),o.top=(ye.iconH-Ie.pbInfoH)/2+"px",o.left="calc(40% - "+Ie.pbInfoW/2+"px)",o.height=Ie.pbInfoH,o.width=Ie.pbInfoW-Ie.pbInfoW/2,$(t).css(o),$(t).css("line-height",Ie.pbInfoH+"px"),$(t).css("font-size",Ie.pbInfoFontSize),$(t).css("font-weight",Ie.pbInfoFontWWeight),$(t).css("color",Ie.pbInfoColor_Page),$(t).css("text-align","left"),t="#"+(e="pbFileInfo_Item"),o.top=(ye.iconH-Ie.pbInfoH)/2+"px",o.left="calc(80% - "+Ie.pbInfoW/2+"px)",o.height=Ie.pbInfoH,o.width=Ie.pbInfoW,$(t).css(o),$(t).css("line-height",Ie.pbInfoH+"px"),$(t).css("font-size",Ie.pbInfoFontSize),$(t).css("font-weight",Ie.pbInfoFontWWeight),$(t).css("color",Ie.pbInfoColor_Item),$(t).css("text-align","left")}(),Ta(e,!1)},onResize:function(){Da(),kn(),_n()},canvasCtrl:function(e){var t=na;switch(e){case f.start:return!1;case f.move:t.hasTempDraw=!0;break;case f.end:0==Sa.drawText&&(t.hasTempDraw=!1,t.mergeTempDraw=!0);break;case f.undo:t.canvasStep>0&&(t.reqUndo=!0);break;case f.redo:t.canvasStep<t.canvasArray.length-1&&(t.reqRedo=!0)}return!1},imageProcess:va,chgBaseImgCtrl:function(e,t,o){var a=na;switch(e){case v.before:break;case v.after:if(0==a.curImage)return;sa(!1),da(aa.image),sa(!Yt),a.imgW=a.curImage.width,a.imgH=a.curImage.height,a.baseImageContext.drawImage(a.curImage,0,0,a.curImage.width,a.curImage.height),va(),ia(!1),en(!0)}},imgW:Ie.defPictureW,imgH:Ie.defPictureH,curImage:0,curMode:aa.thumbnail,zoomRatio:1,zoomX:0,zoomY:0,zoomW:Ie.defPreviewRsoX,zoomH:Ie.defPreviewRsoY,panWinW:0,panWinH:0,zoomScrollBarPos:0};function ia(e){p("thumbDiv",e)}function ra(e){var t,o;switch(e.target.id){case"btn_delete":(t=$("img.selected,Video.selected")).length&&dn("btn_delete",ya,Ia);break;case"btn_saveDisk":for(t=$("img.selected,Video.selected"),o=0;o<t.length;o++)if("IMG"==t[o].tagName){0;break}Ot(t);break;case"btn_toggleAll":Sa.thumbFileCnt!=Sa.thumbSelectedFileCnt?(Nn(!0),Sa.thumbSelectedFileCnt=Sa.thumbFileCnt):(Nn(!1),Sa.thumbSelectedFileCnt=0),Qn();break;case"btn_Next":!async function(){Sa.thumbnailCurrPage+=1,Sa.thumbnailCurrPage=Sa.thumbnailCurrPage%Sa.thumbnailTotalPage,await Yn()}();break;case"btn_Previous":!async function(){Sa.thumbnailCurrPage+=Sa.thumbnailTotalPage-1,Sa.thumbnailCurrPage=Sa.thumbnailCurrPage%Sa.thumbnailTotalPage,await Yn()}()}D(e)}function ca(e){sa(!1),da(aa.thumbnail),sa(!0),en(!1),ia(!0),e.curMode=aa.thumbnail,e.zoomRatio=1,e.zoomScrollBarPos=0,Tn(!1),ln()}function la(e){var t,o=na;switch("ppbtn_transform"==e.target.id&&(0==$("#cropBox").length?(attachCropBox(Ye,Xe),dn("btn_delete",pa,ga)):(dn("btn_delete",pa,ga),removeCropBox())),e.target.id){case"ppbtn_closeAndBackPlayback":ca(o);break;case"ppbtn_redo":an(f.redo);break;case"ppbtn_undo":an(f.undo);break;case"ppbtn_importPic":Rt();break;case"ppbtn_savePlayback":hn(o.combineCanvas,"",!0);break;case"ppbtn_zoom":$("#configDlg").hide(),$("#zoomDlg").toggle(500);break;case"ppbtn_transform":break;case"ppbtn_ocr":t={launch:!0,senderName:we},chrome.runtime.sendMessage(OcrAppID,t,(function(e){if(chrome.runtime.lastError)return $("#dialogOcr").dialog({dialogClass:"no-close",autoOpen:!1,width:250,height:140,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500},buttons:{"Add it now":function(){var e=OcrAppLink;window.open(e),$(this).dialog("close")},Later:function(){$(this).dialog("close")}}}),$("#dlgOcrTxt").text("This feature requires installing a free OCR extension from the Chrome Web Store."),void $("#dialogOcr").dialog("open");document.getElementById("displayCanvas").toBlob((function(e){setTimeout((function(){fa(e)}),200)}))}))}D(e)}function sa(e){var t=na;p(t.lToolBar,e),p(t.rToolBar,e),p(t.bToolBar,e)}function da(e){var t=na;switch(e){case aa.thumbnail:t.lToolBar="thumbnailToolBar",t.rToolBar="playbackRToolBar",t.bToolBar="playbackInfoBar";break;case aa.image:t.lToolBar="picPlaybackToolBar",t.rToolBar="drawingToolBar",t.bToolBar="drawingCfgArea"}}function ua(e){e&&function(){var e=document.getElementById("croppath").getAttribute("d").split(/(?=[LMC])/),t=[],o=[];t[0]=parseInt(e[0].replace("M","").replace("L","").replace("Z","").split(",")[0]),t[1]=parseInt(e[0].replace("M","").replace("L","").replace("Z","").split(",")[1]),t[2]=parseInt(e[1].replace("M","").replace("L","").replace("Z","").split(",")[0]),t[3]=parseInt(e[1].replace("M","").replace("L","").replace("Z","").split(",")[1]),t[4]=parseInt(e[2].replace("M","").replace("L","").replace("Z","").split(",")[0]),t[5]=parseInt(e[2].replace("M","").replace("L","").replace("Z","").split(",")[1]),t[6]=parseInt(e[3].replace("M","").replace("L","").replace("Z","").split(",")[0]),t[7]=parseInt(e[3].replace("M","").replace("L","").replace("Z","").split(",")[1]);var a=na,n=a.curImage,i=document.getElementById("displayCanvas").width,r=document.getElementById("displayCanvas").height;a.zoomRatio>1?(t[0]=parseInt(a.zoomX+t[0]/i*n.width/a.zoomRatio),t[1]=parseInt(a.zoomY+t[1]/r*n.height/a.zoomRatio),t[2]=parseInt(a.zoomX+t[2]/i*n.width/a.zoomRatio),t[3]=parseInt(a.zoomY+t[3]/r*n.height/a.zoomRatio),t[4]=parseInt(a.zoomX+t[4]/i*n.width/a.zoomRatio),t[5]=parseInt(a.zoomY+t[5]/r*n.height/a.zoomRatio),t[6]=parseInt(a.zoomX+t[6]/i*n.width/a.zoomRatio),t[7]=parseInt(a.zoomY+t[7]/r*n.height/a.zoomRatio)):(t[0]=t[0]/i*n.width,t[1]=t[1]/r*n.height,t[2]=t[2]/i*n.width,t[3]=t[3]/r*n.height,t[4]=t[4]/i*n.width,t[5]=t[5]/r*n.height,t[6]=t[6]/i*n.width,t[7]=t[7]/r*n.height);var c=(t[0]+t[6])/2,l=(t[1]+t[3])/2,s=Math.floor((t[2]+t[4])/2-c),d=Math.floor((t[7]+t[5])/2-l);o[0]=c,o[1]=l,o[2]=c+s,o[3]=l,o[4]=c+s,o[5]=l+d,o[6]=c,o[7]=l+d,perspectiveTran=PerspT(t,o);for(var u=I(n),p=u.getContext("2d",{willReadFrequently:!0}),g=p.getImageData(0,0,s,d),m=p.getImageData(0,0,n.width,n.height).data.slice(0),f=0;f<d;f++)for(var h=0;h<s;h++){var b=perspectiveTran.transformInverse(h+c,f+l),v=4*(f*s+h),w=4*(Math.round(b[1])*n.width+Math.round(b[0]));g.data[v]=m[w],g.data[v+1]=m[w+1],g.data[v+2]=m[w+2]}(u=document.getElementById("saveFileCanvas")).width=s,u.height=d,u.getContext("2d",{willReadFrequently:!0}).putImageData(g,0,0);var y=new Image;function I(e){var t=document.getElementById("saveFileCanvas"),o=t.getContext("2d",{willReadFrequently:!0});return $("#saveFileCanvas").attr("width",e.width),$("#saveFileCanvas").attr("height",e.height),o.drawImage(e,0,0,e.width,e.height),t}y.onload=function(){ha(this)},y.width=s,y.height=d,y.src=u.toDataURL(),Sn()}(),ln()}function pa(){zt(ua),Pt(!0)}function ga(){Pt(!1),Wo.freeze=!1}function ma(){var e=document.getElementById("croppath").getAttribute("d").split(/(?=[LMC])/),t=[],o=[],a=[],n=[],r=[];a[0]=parseInt(e[0].replace("M","").replace("L","").replace("Z","").split(",")[0]),a[1]=parseInt(e[0].replace("M","").replace("L","").replace("Z","").split(",")[1]),a[2]=parseInt(e[1].replace("M","").replace("L","").replace("Z","").split(",")[0]),a[3]=parseInt(e[1].replace("M","").replace("L","").replace("Z","").split(",")[1]),a[4]=parseInt(e[2].replace("M","").replace("L","").replace("Z","").split(",")[0]),a[5]=parseInt(e[2].replace("M","").replace("L","").replace("Z","").split(",")[1]),a[6]=parseInt(e[3].replace("M","").replace("L","").replace("Z","").split(",")[0]),a[7]=parseInt(e[3].replace("M","").replace("L","").replace("Z","").split(",")[1]);var c=(a[1]+a[3]+a[5]+a[7])/4;for(i=0;i<4;i++){a[2*i+1]-c<0?(n.push(a[2*i]),n.push(a[2*i+1])):(r.push(a[2*i]),r.push(a[2*i+1]))}for(;n.length>0;){var l=0,s=9999;for(i=0;i<n.length;i++)n[2*i]<s&&(s=n[2*i],l=i);t.push(n[2*l]),t.push(n[2*l+1]),n.splice(2*l,2)}for(;r.length>0;){var d=0,u=-9999;for(i=0;i<r.length;i++)n[2*i]>u&&(u=n[2*i],d=i);t.push(r[2*d]),t.push(r[2*d+1]),r.splice(2*d,2)}var p=Wo,g=document.getElementById("displayCanvas").width,m=document.getElementById("displayCanvas").height;t[0]=t[0]/g*p.imgW,t[1]=t[1]/m*p.imgH,t[2]=t[2]/g*p.imgW,t[3]=t[3]/m*p.imgH,t[4]=t[4]/g*p.imgW,t[5]=t[5]/m*p.imgH,t[6]=t[6]/g*p.imgW,t[7]=t[7]/m*p.imgH;var f=(t[0]+t[6])/2,h=(t[1]+t[3])/2,b=Math.abs(Math.floor((t[2]+t[4])/2-f)),v=Math.abs(Math.floor((t[7]+t[5])/2-h));o[0]=f,o[1]=h,o[2]=f+b,o[3]=h,o[4]=f+b,o[5]=h+v,o[6]=f,o[7]=h+v,perspectiveTran=PerspT(t,o);var w=document.getElementById("previewArea-combineCanvas"),y=document.getElementById("tempCanvas");y.width=w.width,y.height=w.height;var I=y.getContext("2d",{willReadFrequently:!0});I.drawImage(w,0,0);for(var x=new ImageData(b,v),C=I.getImageData(0,0,p.imgW,p.imgH).data.slice(0),$=0;$<v;$++)for(var B=0;B<b;B++){var S=perspectiveTran.transformInverse(B+f,$+h),W=4*($*b+B),k=4*(Math.round(S[1])*p.imgW+Math.round(S[0]));x.data[W]=C[k],x.data[W+1]=C[k+1],x.data[W+2]=C[k+2],x.data[W+3]=255}var _=document.getElementById("saveFileCanvas");return _.width=b,_.height=v,_.getContext("2d",{willReadFrequently:!0}).putImageData(x,0,0),_}function fa(e){var t=262144,o=0,a=t,n=e.size%t,i=Math.floor(e.size/t),r=0;0!=n&&(i+=1);var c=new FileReader;document.getElementById("displayCanvas");function l(){if(!(++r>i)){r==i&&0!=n&&(a=o+n);var l=e.slice(o,a);o=a,a+=t,c.readAsBinaryString(l)}}c.onload=function(){var e={blobAsText:c.result,mimeString:"mimeString",chunks:i};chrome.runtime.sendMessage(OcrAppID,e,(function(e){chrome.runtime.lastError})),l()},c.onerror=function(){appendLog("An error ocurred while reading file")},l()}function ha(e){var t=na;t.curImage=e,t.curMode=aa.image,pn(e.width,e.height),ln(),kn(),_n()}function ba(e,t){var o=na;e.drawImage(t,0,0,o.imgW,o.imgH,0,0,o.imgW,o.imgH)}function va(){var e=na;ba(e.imageProcessContext,e.baseImageCanvas),function(){var e=na;e.reqUndo?(e.reqUndo=!1,rn(e)):e.reqRedo?(e.reqRedo=!1,cn(e)):function(){var e=na;1==e.zoomRatio?ba(e.combineContext,e.imageProcessCanvas):e.combineContext.drawImage(e.imageProcessCanvas,e.zoomX,e.zoomY,e.zoomW,e.zoomH,0,0,e.imgW,e.imgH);e.mergeTempDraw&&(e.mergeTempDraw=!1,ba(e.drawingContext,e.tempDrawingCanvas),Ka(e));ba(e.combineContext,e.drawingCanvas),function(){var e=na;e.hasTempDraw&&ba(e.combineContext,e.tempDrawingCanvas);!function(){var e=na;_a(e)&&Da()}()}()}()}()}function wa(e){var t;ln(),e&&(t=$("img.selected, video.selected"),Lt(t))}function ya(){var e,t,o;zt(wa),e="btnCancel",o=(t="confirmDlg")+"_no",Dn(t+"_yes","btnDelete"),Dn(o,e),Pt(!0)}function Ia(){Pt(!1)}var xa={baseId:"drawingArea",lToolBar:"drawingBoardToolBar",rToolBar:"drawingToolBar",bToolBar:"drawingCfgArea",taskCtrl:function(e){e||ve(!1)},start:function(){Ca()},init:function(){var e=xa;tt(e),Qa(e),e.baseImageContext.rect(0,0,e.imgW,e.imgH),e.baseImageContext.fillStyle=Ie.drawingBoardBgColor,e.baseImageContext.fill(),e.combineContext.drawImage(e.baseImageCanvas,0,0,e.imgW,e.imgH,0,0,e.imgW,e.imgH),Ta(e,!1)},onResize:Ca,canvasCtrl:function(e){var t=xa;switch(e){case f.start:return!1;case f.move:t.hasTempDraw=!0;break;case f.end:0==Sa.drawText&&(t.hasTempDraw=!1,t.mergeTempDraw=!0);break;case f.undo:t.canvasStep>0&&(t.reqUndo=!0);break;case f.redo:t.canvasStep<t.canvasArray.length-1&&(t.reqRedo=!0)}return!1},imageProcess:function(){var e=xa;Ba(e.imageProcessContext,e.baseImageCanvas),function(){var e=xa;e.reqUndo?(e.reqUndo=!1,rn(e)):e.reqRedo?(e.reqRedo=!1,cn(e)):function(){var e=xa;Ba(e.combineContext,e.imageProcessCanvas),e.mergeTempDraw&&(e.mergeTempDraw=!1,Ba(e.drawingContext,e.tempDrawingCanvas),Ka(e));Ba(e.combineContext,e.drawingCanvas),function(){var e=xa;e.hasTempDraw&&Ba(e.combineContext,e.tempDrawingCanvas);!function(){var e=xa;_a(e)&&Da()}()}()}()}()},imgW:Ie.defDrawingBoardW,imgH:Ie.defDrawingBoardH,hasTempDraw:!1,mergeTempDraw:!1,reqUndo:!1,reqRedo:!1};function Ca(){Da()}function $a(e){var t=xa;switch(e.target.id){case"dbbtn_undo":an(f.undo);break;case"dbbtn_redo":an(f.redo);break;case"dbbtn_importPic":Rt();break;case"dbbtn_savePlayback":Po(),hn(t.combineCanvas)}D(e)}function Ba(e,t){var o=xa;e.drawImage(t,0,0,o.imgW,o.imgH,0,0,o.imgW,o.imgH)}var Sa={appVersion:"20180904-1",curMode:void 0,showToolBar:!0,imgW:void 0,imgH:void 0,reqImgW:void 0,reqImgH:void 0,baseCanvas:void 0,baseContext:void 0,drawCanvas:void 0,drawContext:void 0,drawStyle:void 0,eraserStyle:void 0,clearStyle:"rgba(0,0,0,0)",opacity:void 0,lineWidth:void 0,colorHex:void 0,colorR:void 0,colorG:void 0,colorB:void 0,drawStartX:void 0,drawStartY:void 0,drawCurX:void 0,drawCurY:void 0,drawLastX:void 0,drawLastY:void 0,drawing:void 0,drawingMove:!1,fnDraw:void 0,activeDlg:!1,activeDlgCloseFn:!1,previewBrightnessAdj:0,previewWhiteBalanceAdj:0,previewRotate:0,fontFamily:"Arial",fontStyle:"Normal",fontSize:12,fontBold:!1,fontItalic:!1,drawText:!1,drawFontStyle:void 0,thumbnailCnt:0,thumbnailBuild:!1,thumbnailCurrPage:0,thumbnailTotalPage:1,thumbnailEntries:null,thumbnailReflesh:!1,capturing:!1,lastSaveFilename:"",ctrlPress:!1,showSysInfo:!1,frameRateInit:!1,frameCnt:16,frameSlotIdx:0,frameInterval:[],frameLastTime:0,frameRate:0,thumbFileCnt:0,thumbSelectedFileCnt:0,capturePeriodRun:!1,capturePeriodSec:Ie.pcdCapturePeriodSec,captureIntervalHour:Ie.pcdCaptureIntervalHour,capturePeriodTotalCnt:0,capturePeriodCurCnt:0,capturePeriodMs:0,resizeDelayMs:ye.resizeDelayMs,ipwRadiusExpandRatio:1,ipwExtraSpace:0,panMove:!1,panMoveX:0,panMoveY:0,drawRegularShape:!1,curVideoResolutionList:je,reqVideoResolutionList:!1,idVideoResolutionList:0,curAudioinputList:0,idAudioinputSelect:0,idVideoinputSelect:0,checkVideoResolution:!1};function Wa(e){document.getElementById("appTitle")&&ct("appTitle",e),ct("modeToolBar",e),ct("bottomToolBarData","previewArea"==Sa.curMode.baseId&&!Vt&&!jt&&e),void 0!==Sa.curMode.lToolBar&&ct(Sa.curMode.lToolBar,!Vt&&!jt&&e),void 0!==Sa.curMode.lS1ToolBar&&ct(Sa.curMode.lS1ToolBar,Vt&&e&&!wo),void 0!==Sa.curMode.lS2ToolBar&&ct(Sa.curMode.lS2ToolBar,Vt&&e&&wo),void 0!==Sa.curMode.lMsToolBar&&ct(Sa.curMode.lMsToolBar,jt&&e),void 0!==Sa.curMode.rToolBar&&ct(Sa.curMode.rToolBar,(Vt&&wo||!Vt)&&!jt&&e),void 0!==Sa.curMode.bToolBar&&ct(Sa.curMode.bToolBar,(Vt&&wo||!Vt)&&!jt&&e)}function ka(e){Sa.curMode&&(Wa(!1),Sa.activeDlgCloseFn&&Sa.activeDlgCloseFn(),sn(),Sa.curMode.taskCtrl&&Sa.curMode.taskCtrl(!1),Ta(Sa.curMode,!1)),Sa.curMode=e,Sa.curMode.taskCtrl&&Sa.curMode.taskCtrl(!0),function(e,t){Sa.imgW=e,Sa.imgH=t}(Sa.curMode.imgW,Sa.curMode.imgH),at(),wn(),xn(),Sa.curMode.start&&Sa.curMode.start(),Sa.baseCanvas=Sa.curMode.drawingCanvas,Sa.baseContext=Sa.curMode.drawingContext,Sa.drawCanvas=Sa.curMode.tempDrawingCanvas,Sa.drawContext=Sa.curMode.tempDrawingContext,Sa.imgW=Sa.curMode.imgW,Sa.imgH=Sa.curMode.imgH,Wa(Sa.showToolBar),Ta(Sa.curMode,!0)}function _a(e){return e===Sa.curMode}function Ta(e,t){p(e.baseId,t)}function Da(){var e=Sa.curMode;Oe.drawImage(e.combineCanvas,0,0,e.imgW,e.imgH,0,0,Ye,Xe)}function Ha(){var e;$("#displayCanvas").on("mousedown",Na).on("mousemove",Ua).on("mouseup",qa).on("mouseout",Va).on("touchstart",Ma).on("touchend",Pa).on("touchmove",za).on("touchcancel",Fa),e=0,c("uiArea","sysInfoWin"),yn("appVersion",e++),yn("cfgVersion",e++),yn("imgSize",e++),yn("frmRate",e++),yn("redoundo",e++),Cn(!1)}function Ma(e){Ra(e)}function Pa(e){Ra(e)}function za(e){Ra(e)}function Fa(e){}function Ra(e){if(e.originalEvent){Ga();var t=e.originalEvent.changedTouches[0],o="";switch(e.type){case"touchstart":o="mousedown";break;case"touchmove":o="mousemove";break;case"touchend":o="mouseup";break;default:return}var a="mousemove"==o?1:0,n=new MouseEvent(o,{bubbles:!0,cancelable:!0,view:window,detail:1,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,buttons:a,relatedTarget:null});t.target.dispatchEvent(n),"pen"!==e.pointerType&&e.preventDefault()}}var Aa,Ea,La,Oa,Ya=null,Xa=0;function Ga(){if(Yt){var e=document.getElementById("sys_fullPhoto");e.style.backgroundColor=Ie.toolBarColorLeave,e.style.opacity=Ie.toolBarOpacityLeave,Xa=3,Ya||(Ya=setInterval((function(){if(0==(Xa-=1)){if(Yt){var e=document.getElementById("sys_fullPhoto");e.style.backgroundColor=Ie.toolBarColorHide,e.style.opacity=Ie.toolBarOpacityHide}clearInterval(Ya),Ya=null}}),1e3))}}function Ua(e){if(Sa.fnDraw&&Sa.drawing&&(0==e.buttons?(void 0===Aa&&(Aa=e),on(Aa),Sa.fnDraw(f.end),Sa.drawing=!1,Sa.drawingMove&&an(f.end)):(on(e),Aa=e,Sa.drawingMove=!0,Sa.fnDraw(f.move),an(f.move))),de){var t=$("#importPictureWin").data("picData");t.mouseDown&&(0==t.type?ge(e):pe(t.type,e))}Ga()}function Na(e){gn(w.displayCanvas,g.click,e),!Sa.fnDraw||ri&&!ci||(Za(),Sa.drawing=!0,Sa.drawingMove=!1,function(e){var t=1;Sa.drawStartX=e.offsetX*t,Sa.drawStartY=e.offsetY*t,Sa.drawStartX=Math.floor(10*Sa.drawStartX)/10,Sa.drawStartY=Math.floor(10*Sa.drawStartY)/10,Sa.drawCurX=Sa.drawLastX=Sa.drawStartX,Sa.drawCurY=Sa.drawLastY=Sa.drawStartY}(e),Sa.fnDraw(f.start),an(f.start))}function qa(e){if(Sa.fnDraw&&Sa.drawing&&(on(e),Sa.fnDraw(f.end),Sa.drawing=!1,an(f.end)),de){$("#importPictureWin").data("picData").mouseDown=!1,ue(),de=!1}}function Va(e){Sa.fnDraw&&Sa.drawing&&2==S(xe,1)&&(Sa.fnDraw(f.end),an(f.end))}function ja(e){e&&(e.width+=0)}function Za(){ja(Sa.drawCanvas)}function Ka(e){e.canvasArray.length&&e.canvasStep!=e.canvasArray.length-1&&(e.canvasArray.length=e.canvasStep+1),e.canvasStep+=1,e.canvasArray.push(e.drawingCanvas.toDataURL())}function Ja(e){e.canvasArray.length=0,e.canvasStep=-1,ja(e.drawingCanvas),Ka(e)}function Qa(e){e.canvasArray=new Array,Ja(e)}function en(e){p("displayCanvas",e)}function tn(){Sa.drawStyle="rgba("+Sa.colorR+", "+Sa.colorG+", "+Sa.colorB+", "+Sa.opacity+")",Sa.eraserStyle="rgba("+Sa.colorR+", "+Sa.colorG+", "+Sa.colorB+", "+Ie.eraserOpacity+")"}function on(e){Sa.drawLastX=Sa.drawCurX,Sa.drawLastY=Sa.drawCurY,Sa.drawCurX=1*e.offsetX,Sa.drawCurY=1*e.offsetY,Sa.drawCurX=Math.floor(10*Sa.drawCurX)/10,Sa.drawCurY=Math.floor(10*Sa.drawCurY)/10}function an(e){var t=Sa.curMode;if(t.canvasCtrl&&1==t.canvasCtrl(e))xn();else{switch(e){case f.start:case f.move:case f.end:case f.undo:case f.redo:case f.mirror:case f.flip:case f.brightness:case f.whiteBalance:case f.zoom:case f.pan:t.imageProcess&&t.imageProcess()}xn()}}function nn(e){var t=new Image;t.src=e.canvasArray[e.canvasStep],t.onload=function(){ja(e.drawingCanvas),e.drawingContext.drawImage(t,0,0,e.imgW,e.imgH,0,0,e.imgW,e.imgH),e.imageProcess&&e.imageProcess()}}function rn(e){e.canvasStep>0&&(e.canvasStep-=1,nn(e))}function cn(e){e.canvasStep<e.canvasArray.length-1&&(e.canvasStep+=1,nn(e))}function ln(){Sa.activeDlgCloseFn&&Sa.activeDlgCloseFn(),sn()}function sn(){Sa.activeDlgCloseFn=!1,Sa.activeDlg=!1,$("#configDlg").hide(),$("#zoomDlg").hide(),$("#configDrawDlg").hide(),removeCropBox()}function dn(e,t,o){Sa.activeDlgCloseFn&&(Sa.activeDlgCloseFn(),Sa.activeDlgCloseFn=!1),Sa.activeDlg!=e?(Sa.activeDlg=e,o&&(Sa.activeDlgCloseFn=o),t&&t()):Sa.activeDlg=!1}function un(){var e;1!==Ie.disableDrawTextSetting&&(e=document.getElementById("sdfontFamily").selectedIndex,Sa.fontFamily=Fe[e][b.value],e=document.getElementById("fontStyle").selectedIndex,Sa.fontStyle=Re[e][b.value],e=document.getElementById("fontSize").selectedIndex,Sa.fontSize=Ee[e][b.value])}async function pn(e,t){var o=Sa.curMode;o.chgBaseImgCtrl&&await o.chgBaseImgCtrl(v.before,e,t),Wo.imgW=e,Wo.imgH=t,xa.imgW=e,xa.imgH=t,et(Wo,e,t),et(xa,e,t),Za(),Ja(o),at(),wn(),xn(),o.chgBaseImgCtrl&&await o.chgBaseImgCtrl(v.after,e,t),Sn(),kn(),_n()}function gn(e,t,o){if(t===g.click)ve(!0)}function mn(e){var t=new Date,o=t.getFullYear(),a=t.getMonth()+1,n=t.getDate(),i=t.getHours(),r=t.getMinutes(),c=t.getSeconds(),l=t.getMilliseconds();a<10&&(a="0"+a),n<10&&(n="0"+n),i<10&&(i="0"+i),r<10&&(r="0"+r),c<10&&(c="0"+c),l<10?l="00"+l:l<99&&(l="0"+l);var s=o+a+n+"-"+i+r+c+"-"+l;return""!=e&&(s+="."+e),s}async function fn(e,t){e+=".jpg";cr(t,e)}async function hn(e,t="",o=!1){""==t&&(t=mn(""));var a=t+".jpg";if(Sa.lastSaveFilename==a)return!1;Sa.capturing=!0,Sa.lastSaveFilename=a;var n,i,r,c,l=Ie.thumbW,s=Ie.thumbH,d=Ie.thumbPadding;n=l-2*d,i=s-2*d,e.width/e.height>n/i?(r=n,c=e.height*n/e.width):(r=e.width*i/e.height,c=i);var u=document.getElementById("tempCanvas");u.width=r,u.height=c,u.getContext("2d").drawImage(e,0,0,r,c),e.toBlob((function(e){fn(t,e)}),"image/jpeg",1)}function bn(e){if("Control"!=e.key)switch(e.key){case"I":case"i":Sa.ctrlPress&&(Sa.showSysInfo=!Sa.showSysInfo,Cn(Sa.showSysInfo))}else Sa.ctrlPress=!0}function vn(e){if(Sa.ctrlPress){var t=Sa.curMode.zoomScrollBarPos;t-=e.deltaY/10,t=Math.min(Math.max(t,0),Ie.scrollZoomW),function(e,t){var o;o=(o=1+(Ie.zoomMaxRatio-1)*t/e).toFixed(1),Sa.curMode&&Wn(o,t)}(Ie.scrollZoomW,t)}}function wn(){var e,t,o,a,n={position:"absolute","margin-left":"0px",background:ye.ColorLeave,opacity:ye.OpacityLeave};o=Ie.sysInfoWinW,a=Ie.sysInfoWinH,e=Math.min(Ea-Ie.toolBarIconW,Ge+Ye),e-=o,t=Math.min(Ue+Xe,La-Ie.drawSetH),n.width=o+"px",n.height=a+"px",n.left=e-Ie.sysInfoGap+"px",n.top=t-Ie.sysInfoGap-a+"px",$("#sysInfoWin").css(n),$("#configDrawDlg").css("top","calc(100% - 100px)"),$("#configDrawDlg").css("left",Ea-300-Ie.toolBarIconW+"px");var i=document.getElementById("bottomToolBarData");if(i){var r=Ea/2-30;r<0&&(r=0),i.style.left=r+"px"}}function yn(e,t){var o="sysInfoWin-"+e;u("sysInfoWin",o);var a={position:"absolute","margin-left":"0px"};a.left=Ie.sysInfoGap+"px",a.top=Ie.sysInfoGap+t*Ie.sysInfoH+"px",a.height=Ie.sysInfoH+"px",a.width=Ie.sysInfoWinW-2*Ie.sysInfoGap+"px",$("#"+o).css(a)}function In(e,t){Bn(document.getElementById("sysInfoWin-"+e),t)}function xn(){var e;In("appVersion",Sa.appVersion),In("cfgVersion",Ie.cfgVersion),In("imgSize",Sa.imgW+"x"+Sa.imgH),In("frmRate",Sa.frameRate),In("redoundo",(e=Sa.curMode).canvasStep+1+" / "+e.canvasArray.length)}function Cn(e){e&&(wn(),xn()),p("sysInfoWin",e)}function $n(e){return"url('css/images/icon/"+e+"')"}function Bn(e,t){var o;o=document.createTextNode(t),e.innerText=o.textContent}function Sn(){Wn(1,0),$("#zoomDlg-zoom-slider").val(0)}function Wn(e,t){var o,a,n,i,r,c,l=Sa.curMode;n=l.zoomX+l.zoomW/2,i=l.zoomY+l.zoomH/2,o=n-(r=l.imgW/e)/2,a=i-(c=l.imgH/e)/2,o=Math.max(o,0),a=Math.max(a,0),o=Math.min(o,l.imgW-r),a=Math.min(a,l.imgH-c),l.zoomRatio=e,l.zoomX=o,l.zoomY=a,l.zoomW=r,l.zoomH=c,an(f.zoom),Tn(!(e<=1)),_n(),l.zoomScrollBarPos=t}function kn(){var e,t,o=Sa.curMode,a={position:"absolute","margin-left":"0px",background:Ie.panWinColor,opacity:Ie.panOpacity},n=Ye/8,i=Xe/8;e=Math.max(Ie.toolBarIconW,Ge),t=Math.min(Ue+Xe,La-Ie.drawSetH),a.width=n+"px",a.height=i+"px",a.left=e+Ie.panWinGapX+"px",a.top=t-Ie.panWinGapY-i+"px",$("#panWin").css(a),a.left=0,a.top=0,a.background="undefined",a.opacity=1,$("#cropWin").css(a),Ze("cropWin",n,i),o.panWinW=n,o.panWinH=i}function _n(){var e,t,o,a,n,i,r=Sa.curMode,c=r.panWinW/r.imgW;e=r.zoomX*c,t=r.zoomY*c,o=r.zoomW*c,a=r.zoomH*c,i=(n=document.getElementById("cropWin")).getContext("2d"),ja(n),i.fillStyle=Ie.panCropColor,i.fillRect(e,t,o,a)}function Tn(e){p("panWin",e),p("cropWin",e)}function Dn(e,t){var o;(o=document.getElementById(e))&&(o.title=Mn(t))}function Hn(e,t){var o;(o=document.getElementById(e))&&(o.innerHTML=Mn(t))}function Mn(e){return null==Pn[e]||void 0===Pn[e]?zn[e].message:Pn[e].message}var Pn,zn,Fn,Rn=null;function An(){Ea=window.innerWidth,La=window.innerHeight,Oa=Ie.titleIconH,function(){let e,t,o,a,n,i,r;Yt?(i=t=Ea,r=o=La,a=0,n=0):(i=t=Ea-2*ye.iconW,r=o=La-Oa-ye.drawSetH,a=ye.iconW,n=Oa);ot.left=a,ot.top=n,ot.width=i,ot.height=r,e=$("#displayCanvas"),e.css(ot),e.attr("width",i),e.attr("height",r),Ge=a,Ue=n,Ye=i,Xe=r,nr(fi,hi,i,r),Gi&&Gi.viewport(0,0,Ye,Xe);Wo.imgW=Ye,Wo.imgH=Xe,xa.imgW=Ye,xa.imgH=Xe,et(Wo,Ye,Xe),et(xa,Ye,Xe);const c=document.getElementById("drawingArea-baseImageCanvas"),l=c.getContext("2d");l.fillStyle="rgb(255, 255, 255)",l.fillRect(0,0,c.width,c.height),xa.imageProcessContext&&xa.imageProcess()}(),Sa.curMode&&Sa.curMode.onResize&&Sa.curMode.onResize(),wn(),be(),Ht(),$("#lbMsCnt").length>0&&$("#lbMsCnt").css({top:La-80,left:Ea/2})}function En(){var e,t=[["btn_freehand","btnFreehand"],["btn_arrow","btnArrow"],["btn_eraser","btnEraser"],["btn_line","btnLine"],["btn_rectangleLine","btnRectangle"],["btn_rectangle","btnFilledRectangle"],["btn_circleLine","btnEllipse"],["btn_circle","btnFilledEllipse"],["btn_erase_all","btnEraseAll"],["btn_text","btnText"],["btn_configDraw","btnConfigDraw"],["btn_setting","btnSetting"],["btn_capture","btnCapture"],["btn_freeze","btnFreezeLiveView"],["btn_timesave","btnIntervalShooting"],["btn_mirrow","btnFlipVertical"],["btn_flip","btnFlipHorizontal"],["btn_zoom","btnZoom"],["btn_importPic","btnImportImageFile"],["btn_redo","btnRedo"],["btn_undo","btnUndo"],["btn_record","btnRecord"],["btn_whitebalance","btnWhiteBalance"],["btn_brightness","btnBrightness"],["btn_config","btnConfig"],["mode_about","btnAbout"],["mode_preview","btnLiveView"],["mode_playback","btnGallery"],["mode_drawingBoard","btnDrawingBoard"],["mode_scan","btnScanMode"],["mode_multiscan","btnMultiScanMode"],["sys_close","btnCloseWindow"],["sys_fullScreen","btnMaxWindow"],["sys_fullPhoto","btnHideFunctionIcon"],["sys_smallScreen","btnMinWindow"],["btn_saveDisk","btnSaveToDisk"],["btn_delete","btnDelete"],["btn_toggleAll","btnToogleSelectAll"],["btn_Next","btn_Next"],["btn_Previous","btn_Previous"],["ppbtn_savePlayback","btnSaveToGallery"],["ppbtn_closeAndBackPlayback","btnBackToGallery"],["ppbtn_zoom","btnZoom"],["ppbtn_importPic","btnImportImageFile"],["ppbtn_redo","btnRedo"],["ppbtn_undo","btnUndo"],["ppbtn_transform","ppbtn_transform"],["ppbtn_ocr","ppbtn_ocr"],["dbbtn_savePlayback","btnSaveToGallery"],["dbbtn_redo","btnRedo"],["dbbtn_undo","btnUndo"],["dbbtn_importPic","btnImportImageFile"],["sdVideoRsoIcon","textVideoResolution"],["sdFontIcon","textFont"],["periodicCaptureDlg_periodIcon","textInterval"],["periodicCaptureDlg_intervalIcon","textDuration"],["periodicCaptureDlg_startIcon","btnStart"],["periodicCaptureInfoBar","btnCancel"],["drawingOpacity","textTransparency"],["drawingLineWidth","textWidth"],["scbtn_transform","scbtn_transform"],["scbtn_importPic","scbtn_importPic"],["scbtn_fullcrop","scbtn_fullcrop"],["scbtn_redo","scbtn_redo"],["scbtn_redo2","scbtn_redo"],["scbtn_undo","scbtn_undo"],["scbtn_undo2","scbtn_undo"],["scbtn_preview","scbtn_preview"],["scbtn_saveDisk","scbtn_saveDisk"],["scbtn_ocr","scbtn_ocr"],["scbtn_flip","scbtn_flip"],["scbtn_mirrow","scbtn_mirrow"],["scbtn_fullcrop","scbtn_fullcrop"],["mscbtn_capture","mscbtn_capture"],["mscbtn_merge","mscbtn_merge"],["mscbtn_fullcrop","mscbtn_fullcrop"],["configDlg-brightness-icon","config_brightness"],["configDlg-brightness-slider","config_brightness"],["configDlg-brightness-reset","config_reset"],["configDlg-rotate-icon","config_rotate"],["configDlg-rotate-slider","config_rotate"],["configDlg-rotate-reset","config_reset"],["configDlg-whiteBalence-icon","config_wb"],["configDlg-whiteBalence-slider","config_wb"],["configDlg-whiteBalence-reset","config_reset"],["dialogSave","dlgSave"]],o=[["pbFileInfo_Text","lbPage"],["fontStyle-lbNormal","lbNormal"],["fontStyle-lbBold","lbBold"],["fontStyle-lbItalic","lbItalic"],["fontStyle-lbBoldItalic","lbBoldItalic"],["periodicCaptureDlg_periodUnit","lbSeconds"],["periodicCaptureDlg_intervalUnit","lbMinutes"]],a=document.getElementById("sdLanguageFamily").selectedIndex,n=Ae[a][2];ye.languageIdx=a,$.getJSON(n,(function(a){for(Pn=a,e=0;e<t.length;e++)Dn(t[e][0],t[e][1]);for(e=0;e<o.length;e++)Hn(o[e][0],o[e][1])}))}window.onresize=function(e){if(ye.resizeDelayMs){if(Sa.resizeDelayMs=ye.resizeDelayMs,Rn)return;Rn=setInterval((function(){Sa.resizeDelayMs-=ye.resizeDelayMs/2,Sa.resizeDelayMs<=0&&(clearInterval(Rn),Rn=null,An())}),ye.resizeDelayMs/2)}else An()},window.onmousemove=function(){Ga()},window.onload=async function(){var e,t,o,a,n,i;An(),$("body").css("background-color",Ie.bgColor),(e={position:"absolute",width:Ie.toolBarIconW,height:Ie.toolBarIconH,"margin-left":"0px"}).width=Ie.toolBarIconW,e.height=Ie.toolBarIconH,I(rt,e,"uiArea","playbackRToolBar","right"),1===Ie.disableDrawingToolBar?(I(Ce,e,"uiArea","drawingToolBar","right",to),B(Ce)):(I(xe,e,"uiArea","drawingToolBar","right",to),B(xe)),I(De,e,"uiArea","thumbnailToolBar","left",ra),B(De),I(He,e,"uiArea","picPlaybackToolBar","left",la),B(He),I(Me,e,"uiArea","drawingBoardToolBar","left",$a),B(Me),I(Be,e,"uiArea","previewToolBar","left",_o),B(Be),I(Se,e,"uiArea","scanToolBarS1","left",Io),B(Se),I(We,e,"uiArea","scanToolBarS2","left",Io),B(We),I(ke,e,"uiArea","multiscanToolBar","left",So),B(ke),I(Te,e,"uiArea","sysToolBar","top-right",qt),B(Te),e.width=Ie.modeIconW/2,e.height=ye.drawSetH,I($e,e,"uiArea","bottomToolBarData","bottom",_o),B($e),$("#btn_pause").hide(),e.width=Ie.modeIconW,e.height=Ie.modeIconH,I(_e,e,"uiArea","modeToolBar","top-left",Jt),B(_e),$("#Dummy").unbind("mouseenter mouseleave click"),function(){var e,t=["playbackRToolBar","previewToolBar","drawingToolBar","thumbnailToolBar","picPlaybackToolBar","drawingBoardToolBar","scanToolBarS1","scanToolBarS2"];for(e=0;e<t.length;e++)ct(t[e],!1)}(),dt(),ft(),wt(),le(),r("uiArea",o="configDlg"),t="#"+o,$(t).css("background",ye.ColorLeave),$(t).css("top","calc(50%)"),$(t).css("left",Ie.toolBarIconW+"px"),$(t).css("width","370px"),$(t).css("height","200px"),$(t).css("position","absolute"),$(t).hide(),t="#"+ne(o,t=o+"-brightness","brightness.png",24,36),$(t).attr({type:"range",max:2,min:0,step:.01,value:1}),$(t).on("input",(function(e){Sa.previewBrightnessAdj=Math.floor(e.currentTarget.value),Sa.curMode&&an(f.brightness)})),t="#"+ne(o,t=o+"-rotate","rotate.png",24,84),$(t).attr({type:"range",max:180,min:-180,step:5,value:0}),$(t).on("input",(function(e){Sa.previewRotate=Math.floor(e.currentTarget.value)})),t="#"+ne(o,t=o+"-whiteBalence","wb.png",24,132),$(t).attr({type:"range",max:1.5,min:.5,step:.01,value:1}),$(t).on("input",(function(e){Sa.previewWhiteBalanceAdj=Math.floor(e.currentTarget.value),Sa.curMode&&an(f.whiteBalance)})),ae(),function(){var e,t="aboutDlg",o=t+"-close",a=t+"-content";r("uiArea",t),r(t,o),r(t,a),e="#"+t,$(e).css("top","calc(50% - "+(Ie.aboutWinH-Ie.titleIconH)/2+"px)"),$(e).css("left","calc(50% - "+Ie.aboutWinW/2+"px)"),$(e).css("width",Ie.aboutWinW+"px"),$(e).css("height",Ie.aboutWinH+"px"),$(e).css("position","absolute"),$(e).css("background",Ie.aboutBkg),$(e).css("opacity",Ie.aboutOpacity),e="#"+a,$(e).css("top",Ie.aboutIconH+"px"),$(e).css("left",Ie.aboutGapX+"px"),$(e).css("width",Ie.aboutWinW-2*Ie.aboutGapX+"px"),$(e).css("height",Ie.aboutWinH-Ie.aboutIconH+"px"),$(e).css("position","absolute"),$(e).html('\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<BR>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<BR>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<center><img src="css/images/icon/logo 60.png"></img></center>\t\t\t\t\t\t\t\t\t\t\t<BR>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<BR>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label><font size="5" color="#FF0"><center>Smart DC</center></font></label>\t\t\t\t<BR>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label><font size="3" color="#88F"><center>Version 1.25.0213.2</center></font></label>\t\t\t\t\t<BR>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<BR>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'),e="#companyLink",$(e).click((function(){window.open("http://www.tekspring.com")})),e="#manualLink",$(e).click((function(){window.open("https://www.dropbox.com/s/fa4rvuvi48uvksu/TS-82-913-90022.pdf?dl=0")})),p(t,!1)}(),function(){var e,t,o,a,n,i="periodicCaptureDlg",c=i+"_periodIcon",l=i+"_periodText",s=i+"_periodUnit",d=i+"_intervalIcon",u=i+"_intervalText",p=i+"_intervalUnit",g=i+"_close",m=i+"_startIcon",f=(Ie.pcdIconH-Ie.pcdTextH)/2,h=(Ie.pcdIconH-Ie.pcdUnitH)/2;r("uiArea",i),a=Ie.pcdIconW+Ie.pcdTextW+Ie.pcdUnitW+Ie.pcdExtraW,n=4*Ie.pcdIconH-3*Ie.pcdIconOverlayY,e="#"+i,$(e).css("position","absolute"),$(e).css("background",Ie.pcdBkg),$(e).css("opacity",Ie.pcdOpacity),$(e).css("left","calc(50% - "+a/2+"px)"),$(e).css("top","calc(50% - "+(n-Ie.titleIconH)/2+"px)"),$(e).css("width",a+"px"),$(e).css("height",n+"px"),Bt(i,g,"close.png",t=a-Ie.pcdIconW,o=0),$("#"+g).on("click",Ko),Bt(i,c,"timesave_time.png",t=0,o+=Ie.pcdIconH-Ie.pcdIconOverlayY),Wt(i,l,t+=Ie.pcdIconW,o+f,Sa.capturePeriodSec),St(i,s,t+=Ie.pcdTextW,o+h,""),Bt(i,d,"timesave_keep.png",t=0,o+=Ie.pcdIconH-Ie.pcdIconOverlayY),Wt(i,u,t+=Ie.pcdIconW,o+f,Sa.captureIntervalHour),St(i,p,t+=Ie.pcdTextW,o+h,""),o+=Ie.pcdIconH-Ie.pcdIconOverlayY,Bt(i,m,"timesave_star.png",t=(a-Ie.pcdIconW)/2,o),$("#"+m).on("click",ea),kt(!1)}(),function(){var e,t="periodicCaptureInfoBar",o=t+"_text",a=t+"_icon";c("uiArea",t),_t(),u(t,o),e="#"+o,$(e).css("position","absolute"),$(e).css("left",0),$(e).css("top",(Ie.pcibIconH-Ie.pcibTextH)/2+"px"),$(e).css("width",Ie.pcibTextW+"px"),$(e).css("height",Ie.pcibTextH+"px"),$(e).css("text-align","center"),$(e).css("line-height",Ie.pcibTextH+"px"),$(e).css("font-size",Ie.pcibTextFontSize),$(e).css("color",Ie.pcibTextColor),c(t,a),e="#"+a,$(e).css("position","absolute"),$(e).css("left",Ie.pcibTextW+"px"),$(e).css("top",0),$(e).css("width",Ie.pcibIconW+"px"),$(e).css("height",Ie.pcibIconH+"px"),$(e).css("background",$n("timesave_star.png")),$(e).on("click",Tt),Dt(!1)}(),Mt(),i={position:"absolute",background:Ie.mouseColorLeave,padding:"0 0 0 0px",top:"0px",height:Ie.titleIconH+"px",opacity:Ie.mouseOpacityLeave},a=Ie.modeIconW*_e.length,n=Ie.toolBarIconW*Te.length,i.left=a+"px",i.width="calc(100% - "+(a+n)+"px)",Ha(),Wo.init(),na.init(),xa.init(),At(),ka(Wo);try{await async function(){try{const e=await async function(){try{const e=await navigator.mediaDevices.getUserMedia({video:!0}),t=await async function(e){const t=e.getTracks().map((async e=>{e.stop(),await new Promise((e=>setTimeout(e,100)))}));return await Promise.all(t),!0}(e);return t}catch(e){return"NotAllowedError"===e.name||e.name,!1}}();if(await async function(){try{return(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach((e=>e.stop())),!0}catch(e){return"NotAllowedError"===e.name||e.name,!1}}(),e){yi=await Ci(),Ii=await $i(yi),xi=await Bi(yi);const e=document.getElementById(Sa.idVideoinputSelect),t=document.getElementById(Sa.idAudioinputSelect);if(Ii&&(e.value=Ii.deviceId),xi&&(t.value=xi.deviceId),Ii)return await Fi(),void await zi();Si(!1)}else Si(!1)}catch(e){alert("Please connect the camera."),Yi()}}()}catch(e){}Oi(),En()},document.body.addEventListener("keydown",(function(e){bn(e)})),document.body.addEventListener("keyup",(function(e){!function(e){"Control"!=e.key||(Sa.ctrlPress=!1)}(e)})),document.body.addEventListener("wheel",(function(e){vn(e)})),document.oncontextmenu=function(){return!1};const Ln=30;var On=!1;async function Yn(){if(On)return;On=!0,Fn=[];const e=await o(),a=e.transaction(t,"readonly").objectStore(t).count();a.onsuccess=()=>{var o=a.result;Sa.thumbnailTotalPage=parseInt((o-1)/Ln)+1,Sa.thumbnailCurrPage=Math.min(Sa.thumbnailCurrPage,Sa.thumbnailTotalPage-1);let n=0;var i=Ln*Sa.thumbnailCurrPage,r=Math.min(i+Ln,o);e.transaction(t,"readonly").objectStore(t).openCursor(null,"prev").onsuccess=e=>{const t=e.target.result;return t?(n>=i&&n<r&&Fn.push(t.value),n++,n<r?void t.continue():(Xn(),void(On=!1))):(Xn(),void(On=!1))}}}function Xn(){Sa.thumbSelectedFileCnt=0,Sa.thumbnailCnt=0,Sa.thumbFileCnt=0,ia(!1),$("#thumbDiv").empty();for(var e=0;e<Fn.length;e++)Fn[e].name.indexOf(".jpg")>0&&(Sa.thumbnailCnt+=1,Gn(Fn[e],e)),(Fn[e].name.indexOf(".mp4")>0||Fn[e].name.indexOf(".webm")>0)&&Un(Fn[e],e);Qn(),setTimeout((function(){ia(!0)}),100)}function Gn(e,t,o=!1){var a,n,i,c="thumb_"+t,l="img_"+t,d=Ie.thumbW,u=Ie.thumbH,p=Ie.thumbPadding;if(o){var g=document.createElement("div");g.id=c,document.getElementById("thumbDiv").prepend(g)}else r("thumbDiv",c);n=d-2*p,i=u-2*p,a="#"+c,$(a).css("width",n+"px"),$(a).css("height",i+"px"),$(a).css("padding",p+"px"),$(a).css("position","relative"),$(a).css("display","inline-block"),s(c,l);var m=new Image;m.addEventListener("load",(function(){var t=Et(n,i,m.width,m.height),o=Ie.thumbFrmSize+"px solid "+Ie.thumbFrmColorNormal;a="#"+l;var r={left:t.x+p,top:t.y+p,width:t.w,height:t.h,position:"absolute",border:o};$(a).css(r),$(a).addClass("thumbImg"),(a=document.getElementById(l)).src=e.thumbnailImage,a.fileName=e.name,a.checked=!1,$(a).on("click",(function(e){var t,o,a=document.getElementById(e.target.id);a.checked?(a.checked=!1,t=Ie.thumbFrmColorNormal,jn()):(Nn(!1),a.checked=!0,t=Ie.thumbFrmColorChecked,Vn()),o=Ie.thumbFrmSize+"px solid "+t,$(this).css("border",o),$(this).toggleClass("selected")})),$(a).dblclick((function(){document.getElementById(this.id).checked=!0;var t=Ie.thumbFrmColorChecked;Vn();var o=Ie.thumbFrmSize+"px solid "+t;$(this).css("border",o),$(this).toggleClass("selected");var a=new Image;a.src=e.normalImage,a.addEventListener("load",(function(){ha(a)}))})),qn()})),m.src=e.thumbnailImage}function Un(e,t,o=!1){var a,n,i,c="thumb_"+t,l="img_"+t,s="vIcon_"+t,d=Ie.thumbW,u=Ie.thumbH,p=Ie.thumbPadding;if(o){var g=document.createElement("div");g.id=c,document.getElementById("thumbDiv").prepend(g)}else r("thumbDiv",c);n=d-2*p,i=u-2*p,a="#"+c,$(a).css("width",n+"px"),$(a).css("height",i+"px"),$(a).css("padding",p+"px"),$(a).css("position","relative"),$(a).css("display","inline-block");let m=document.getElementById(c),f=document.createElement("video");f.id=l,m.appendChild(f),r(c,s);var h=Et(n,i,1280,720),b=Ie.thumbFrmSize+"px solid "+Ie.thumbFrmColorNormal;a="#"+l;var v={left:h.x+p,top:h.y+p,width:h.w,height:h.h,position:"absolute",border:b};$(a).css(v),$(a).addClass("thumbImg"),a=document.getElementById(l),e.name.indexOf(".mp4"),a.src=URL.createObjectURL(e.video),a.autoplay=!1,a.controls=!1,a.loop=!1,a.fileName=e.name,a.checked=!1,v={right:6,bottom:17,width:36,height:12,position:"absolute",backgroundColor:"#000",color:"#EEE",textAlign:"center",fontSize:12,opacity:.75},$("#"+s).css(v),a.addEventListener("loadedmetadata",(function(){var e=Math.round(a.duration);document.getElementById(s).innerText=Math.floor(e/60)+":"+gi(e%60,2)})),$(a).on("click",(function(e){var t,o,a=document.getElementById(e.target.id);a.checked?(a.checked=!1,t=Ie.thumbFrmColorNormal,jn()):(Nn(!1),a.checked=!0,t=Ie.thumbFrmColorChecked,Vn()),o=Ie.thumbFrmSize+"px solid "+t,$(this).css("border",o),$(this).toggleClass("selected")})),$(a).dblclick((function(){var e=document.getElementById(this.id);e.checked=!0;var t=Ie.thumbFrmColorChecked;Vn();var o,a=Ie.thumbFrmSize+"px solid "+t;$(this).css("border",a),$(this).toggleClass("selected"),e.muted=!1,e.currentTime=0,(o=e).webkitRequestFullscreen?o.webkitRequestFullscreen():o.mozRequestFullScreen?o.mozRequestFullScreen():o.requestFullscreen?o.requestFullscreen():o.msRequestFullscreen&&o.msRequestFullscreen()})),a.addEventListener("ended",(function(e){null!=document.fullscreenElement&&document.exitFullscreen()}),!1),a.addEventListener("mouseover",(function(e){var t=a.play();void 0!==t&&t.then((e=>{a.muted=!0,a.play()})).catch((e=>{}))})),a.addEventListener("mouseleave",(function(e){var t=a.play();void 0!==t&&t.then((e=>{a.pause(),a.currentTime=0})).catch((e=>{}))})),qn()}function Lt(o){var a;const n=indexedDB.open(e);n.onsuccess=e=>{const n=e.target.result.transaction(t,"readwrite").objectStore(t).openCursor();n.onsuccess=e=>{const t=e.target.result;if(t)for(a=0;a<o.length;a++)t.value.name===o[a].fileName?t.delete():t.continue()},n.onerror=e=>{}},n.onerror=e=>{},Yn()}function Nn(e){var t,o,a,n,i,r=$(".thumbImg"),c="selected";for(e?(a=!0,n=Ie.thumbFrmColorChecked):(a=!1,n=Ie.thumbFrmColorNormal),i=Ie.thumbFrmSize+"px solid "+n,o=0;o<r.length;o++)document.getElementById(r[o].id).checked=a,(t=$("#"+r[o].id)).css("border",i),e?t.addClass(c):t.removeClass(c)}function qn(){Sa.thumbFileCnt+=1,Qn()}function Vn(){Jn()}function jn(){Jn()}var Zn,Kn=-1;function Jn(){-1==Kn?(Kn=2,setTimeout(Jn,100)):Kn>0?(Kn-=1,setTimeout(Jn,100)):(Kn=-1,function(){var e=$(".thumbImg"),t="selected";Sa.thumbSelectedFileCnt=0;for(var o=0;o<e.length;o++){var a=document.getElementById(e[o].id),n=$("#"+e[o].id);a.checked?(Sa.thumbSelectedFileCnt+=1,n.addClass(t)):n.removeClass(t)}Qn()}())}function Qn(){var e,t,o="PAGE: "+Math.min(Sa.thumbnailCurrPage+1,Sa.thumbnailTotalPage)+"/"+Sa.thumbnailTotalPage,a="IMAGE： "+Math.min(Sa.thumbFileCnt,Ln);e=o,t=a,Bn(document.getElementById("pbFileInfo_Page"),e),Bn(document.getElementById("pbFileInfo_Item"),t),function(){var e;e=Sa.thumbFileCnt&&Sa.thumbFileCnt===Sa.thumbSelectedFileCnt?"btnUnselectAll":"btnSelectAll";Dn("btn_toggleAll",e)}()}var ei,ti,oi,ai,ni,ii=[],ri=!1,ci=!1,li=900;function si(e){var t,o=["btn_setting","btn_capture","btn_freeze","btn_mirrow","btn_flip","btn_config","btn_zoom","btn_importPic","btn_redo","btn_undo","btn_freehand","btn_arrow","btn_eraser","btn_line","btn_rectangleLine","btn_rectangle","btn_circleLine","btn_circle","btn_erase_all","btn_text","btn_configDraw","drawingCfgColorBar","drawingOpacity","drawingLineWidth"];for(t=0;t<o.length;t++)ct(o[t],e);e?document.getElementById("sysToolBar").style.background=Ie.toolBarColorLeave:document.getElementById("sysToolBar").style.backgroundColor="#000"}let di,ui;async function pi(){ri=!1,document.getElementById("recordtime").style.visibility="hidden",si(!0),$("#btn_pause").hide(),Zn.stop();var e=(new Date).getTime();ci?(ci=!1,ti=oi):ti=oi+e-ei}function gi(e,t){return(e=""+e).length>=t?e:gi("0"+e,t)}function mi(){if(ri&&!ci){var e=(new Date).getTime();ti=oi+e-ei;var t=Math.floor(ti/1e3);if(t>=li)return void pi();document.getElementById("recordtime").innerText=gi(Math.floor(t/60),2)+" : "+gi(t%60,2),setTimeout((()=>{mi()}),1e3)}}let fi=Ie.defPreviewRsoX,hi=Ie.defPreviewRsoY;const bi=document.getElementById("videoSrc");let vi;let wi=!1,yi=[],Ii=null,xi=null;async function Ci(){try{const e=document.getElementById(Sa.idVideoinputSelect),t=document.getElementById(Sa.idAudioinputSelect);e.innerHTML="",t.innerHTML="";let o=await navigator.mediaDevices.enumerateDevices();return o=o.filter((e=>e.deviceId.length>20)),o.filter((e=>"videoinput"===e.kind&&!e.label.includes("Virtual")&&!e.label.includes("Basler")&&!e.deviceId.includes("communications"))).forEach((t=>{const o=document.createElement("option");o.value=t.deviceId,o.textContent=t.label||`未命名裝置 (${t.deviceId})`,o.device=t,e.appendChild(o)})),o.filter((e=>"audioinput"===e.kind&&!e.label.includes("Virtual")&&!e.deviceId.includes("default")&&!e.deviceId.includes("communications"))).forEach((e=>{const o=document.createElement("option");o.value=e.deviceId,o.textContent=e.label||`未命名裝置 (${e.deviceId})`,o.device=e,t.appendChild(o)})),Ii&&(e.value=Ii.deviceId),xi&&(t.value=xi.deviceId),o.map((e=>({deviceId:e.deviceId,label:e.label,kind:e.kind})))}catch(e){return Yi(),!1}}async function $i(e){const t=e.filter((e=>"videoinput"===e.kind&&!e.label.includes("visual")&&!e.label.includes("Basler")&&!e.deviceId.includes("communications")));for(let e=0;e<t.length;e++)if(Hi(t[e])&&await lr(t[e].deviceId))return t[e];for(let e=0;e<t.length;e++){if(await lr(t[e].deviceId))return t[e];{yi&&(yi=yi.filter((e=>e.deviceId!=t[0].deviceId)));const e=document.getElementById(Sa.idVideoinputSelect),o=Array.from(e.options).find((e=>e.value===t[0].deviceId));o&&o.remove()}}return null}async function Bi(e){let t=null;const o=e.filter((e=>"audioinput"===e.kind&&!e.deviceId.includes("default")&&!e.deviceId.includes("communications")));for(let e=0;e<o.length;e++)if(0==e&&(t=o[0]),Hi(o[e])){t=o[e];break}return t}function Si(e){e?($("#btn_record").hover(_,T).prop("disabled",!1),$("#btn_record").css("background-image","url('css/images/icon/record2.png')")):($("#btn_record").off("mouseenter mouseleave").prop("disabled",!0),$("#btn_record").css("background-image","url('css/images/icon/record3.png')"))}let Wi=!1;let ki=null,_i=!1,Ti=!1;async function Di(){if(_i)return;_i=!0,Ti=!1;let e=await Ci();const t=yi.filter((t=>!e.some((e=>e.deviceId===t.deviceId)))),o=e.filter((e=>!yi.some((t=>t.deviceId===e.deviceId))));t.length,o.length;const a=document.getElementById(Sa.idVideoinputSelect),n=document.getElementById(Sa.idAudioinputSelect);let i=!1;const r=o.filter((e=>"videoinput"==e.kind)),c=t.filter((e=>"videoinput"==e.kind));r.length,c.length,r.length>0&&null==Ii&&(Ii=await $i(e),i=!0),Wi&&(Wi=!1,Si(!1),ri&&await pi(),await Fi(),Xi(),Ii&&(e=e.filter((e=>e.deviceId!=Ii.deviceId))),Ii=await $i(e),Ii?(a.value=Ii.deviceId,i=!0):a.value=null);const l=o.filter((e=>"audioinput"==e.kind)),s=t.filter((e=>"audioinput"==e.kind));l.length,s.length,l.length>0&&(null==xi||Hi(l[0]))&&(n.value=l[0].deviceId,xi=l[0]),s.length>0&&(xi=await Bi(e),n.value=xi?xi.deviceId:null),i&&Ii&&(wi=!1,await zi()),yi=e,_i=!1,Ti&&await Di()}function Hi(e){return!(!e||!e.label)&&e.label.includes("Document Camera")}async function Mi(e,t){Yt?(Ye=Ea,Xe=La,Ge=0,Ue=0):(Ye=Ea-2*ye.iconW,Xe=La-Oa-ye.drawSetH,Ge=ye.iconW,Ue=Oa),ot.left=Ge,ot.top=Ue,ot.width=Ye,ot.height=Xe;const o=$("#displayCanvas");o.css(ot),o.attr("width",Ye),o.attr("height",Xe),fi=e,hi=t,Wo.imgW=Ye,Wo.imgH=Xe,Sa.imgW=Ye,Sa.imgH=Xe,nr(fi,hi,Ye,Xe),Gi&&Gi.viewport(0,0,Ye,Xe);Sa.curMode;Wo.imgW=Ye,Wo.imgH=Xe,xa.imgW=Ye,xa.imgH=Xe,et(Wo,Ye,Xe),et(xa,Ye,Xe);const a=document.getElementById("drawingArea-baseImageCanvas"),n=a.getContext("2d");n.fillStyle="rgb(255, 255, 255)",n.fillRect(0,0,a.width,a.height),xa.imageProcess(),wn(),xn(),Sn(),kn(),_n()}navigator.mediaDevices.addEventListener("devicechange",(()=>{ki&&clearTimeout(ki),ki=setTimeout((()=>{Ti=!0,ki=null,Di()}),500)}));let Pi="unknow";async function zi(){const e=await async function(){let e=null;if(!Ii)return null;if(Hi(Ii))fi=1920,hi=1080,e={video:{deviceId:{exact:Ii.deviceId},width:{exact:fi},height:{exact:hi}}},Sa.reqVideoResolutionList=[[fi,hi,1]],await void 0;else{const t=await navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:Ii.deviceId}}}),o=t.getVideoTracks()[0].getSettings();t.getTracks().forEach((e=>e.stop())),fi=o.width,hi=o.height,Sa.reqVideoResolutionList=[[fi,hi,1]],await void 0,e={video:{deviceId:{exact:Ii.deviceId},width:{ideal:1920},height:{ideal:1080}}}}return e}();if(e)try{if(window.stream=await navigator.mediaDevices.getUserMedia(e),!window.stream)return;const t=window.stream.getVideoTracks()[0];t.onended=()=>{Fi(),Xi(),Wi=!0};const o=t.getSettings();Pi=o.facingMode,bi.srcObject=window.stream,bi.setAttribute("playsinline",""),bi.setAttribute("webkit-playsinline",""),bi.onloadeddata=()=>{!function(){let e=document.getElementById("previewArea-WebGL");if(!(Gi=e.getContext("webgl")))throw new Error("WebGL not supported");const t="\n      attribute vec4 a_position;\n      attribute vec2 a_texCoord;\n      varying vec2 v_texCoord;\n      void main() {\n        gl_Position = a_position;\n        v_texCoord = a_texCoord;\n      }\n    ",o="\n      precision mediump float;\n      uniform sampler2D u_image;\n      uniform float u_brightness;\n      uniform vec3 u_whiteBalance;\n      varying vec2 v_texCoord;\n      \n      void main() {\n        vec4 color = texture2D(u_image, v_texCoord);\n\n        color.rgb *= u_brightness; // Apply brightness adjustment\n        color.r *= u_whiteBalance.r;\n        color.g *= u_whiteBalance.g;\n        color.b *= u_whiteBalance.b;\n        gl_FragColor = color;\n      }\n    ";Ni=tr(Gi,Gi.VERTEX_SHADER,t),qi=tr(Gi,Gi.FRAGMENT_SHADER,o),Vi=function(e,t,o){const a=e.createProgram();if(e.attachShader(a,t),e.attachShader(a,o),e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS))return e.deleteProgram(a),null;return a}(Gi,Ni,qi),ji=Gi.getAttribLocation(Vi,"a_position"),Zi=Gi.getAttribLocation(Vi,"a_texCoord"),Ki=Gi.getUniformLocation(Vi,"u_brightness"),Ji=Gi.getUniformLocation(Vi,"u_whiteBalance"),Qi=Gi.createBuffer(),Gi.bindBuffer(Gi.ARRAY_BUFFER,Qi),er=Gi.createBuffer(),Gi.bindBuffer(Gi.ARRAY_BUFFER,er),Ui=Gi.createTexture(),Gi.bindTexture(Gi.TEXTURE_2D,Ui),Gi.texParameteri(Gi.TEXTURE_2D,Gi.TEXTURE_WRAP_S,Gi.CLAMP_TO_EDGE),Gi.texParameteri(Gi.TEXTURE_2D,Gi.TEXTURE_WRAP_T,Gi.CLAMP_TO_EDGE),Gi.texParameteri(Gi.TEXTURE_2D,Gi.TEXTURE_MIN_FILTER,Gi.LINEAR)}(),Mi(bi.videoWidth,bi.videoHeight)},bi.addEventListener("pause",(()=>{"visible"===document.visibilityState&&bi.paused&&bi.play().catch((e=>{}))})),await bi.load();const a=bi.play();void 0!==a&&await a.then((e=>{bi.muted=!0,bi.hidden=!0,wi=!0,Si(!0)}))}catch(e){Yi()}}async function Fi(){window.stream&&(window.stream.getTracks().forEach((function(e){e.stop(),window.stream.removeTrack(e)})),setTimeout((()=>{0==window.stream.active&&(window.stream=null)}),100),bi.srcObject=null),wi=!1,Si(!1)}let Ri,Ai,Ei=-1,Li=null;async function Oi(){if(bi||(bi=document.getElementById("videoSrc")),Ri||(Ri=document.getElementById("previewArea-WebGL")),Ai||(Li=document.getElementById("previewArea-videoOrg"),Ai=Li.getContext("2d")),wi){Gi.bindTexture(Gi.TEXTURE_2D,Ui),Gi.texImage2D(Gi.TEXTURE_2D,0,Gi.RGBA,Gi.RGBA,Gi.UNSIGNED_BYTE,bi),Gi.useProgram(Vi),Gi.bindBuffer(Gi.ARRAY_BUFFER,Qi),Gi.bufferData(Gi.ARRAY_BUFFER,new Float32Array(or),Gi.STATIC_DRAW),Gi.vertexAttribPointer(ji,2,Gi.FLOAT,!1,0,0),Gi.enableVertexAttribArray(ji),Gi.bindBuffer(Gi.ARRAY_BUFFER,er),Gi.bufferData(Gi.ARRAY_BUFFER,new Float32Array(ar),Gi.STATIC_DRAW),Gi.vertexAttribPointer(Zi,2,Gi.FLOAT,!1,0,0),Gi.enableVertexAttribArray(Zi);const t=parseFloat(document.getElementById("configDlg-brightness-slider").value);Gi.uniform1f(Ki,t);const o=parseFloat(document.getElementById("configDlg-whiteBalence-slider").value);Gi.uniform3f(Ji,o,1,2-o),Gi.clear(Gi.COLOR_BUFFER_BIT),Gi.drawArrays(Gi.TRIANGLES,0,6);var e=bi.currentTime;e&&e!==Ei&&(Ei=e,vi=new Date,Oo(Ri));const a=window.stream.getVideoTracks()[0].getSettings();fi!=a.width&&Mi(a.width,a.height)}requestAnimationFrame(Oi)}function Yi(){Si(!1),Xi()}function Xi(){const e=document.getElementById("displayCanvas"),t=e.getContext("2d");t.fillStyle="rgba(128, 128, 128, 1)",t.fillRect(0,0,e.width,e.height)}var Gi,Ui,Ni,qi,Vi,ji,Zi,Ki,Ji,Qi,er;function tr(e,t,o){const a=e.createShader(t);return e.shaderSource(a,o),e.compileShader(a),e.getShaderParameter(a,e.COMPILE_STATUS)?a:(e.deleteShader(a),null)}$(document.body).on("mouseup",(e=>{if(e.target===document.body)ln();else if("displayCanvas"===e.target.id)ln()}));let or=[],ar=[];function nr(e,t,o,a){const n=e/t,i=o/a;if(i>n){const e=(1-n/i)/2,t=1-e;or=[-1,-1,1,-1,-1,1,-1,1,1,-1,1,1],ar=[0,t,1,t,0,e,0,e,1,t,1,e]}else{const e=(1-i/n)/2,t=1-e;or=[-1,-1,1,-1,-1,1,-1,1,1,-1,1,1],ar=[e,1,t,1,e,0,e,0,t,1,t,0]}}let ir=null;async function rr(){try{"wakeLock"in navigator&&(ir=await navigator.wakeLock.request("screen"),ir.addEventListener("release",(()=>{})))}catch(e){}}async function cr(e,t){const o=new Blob([e],{type:"application/octet-stream"}),a=URL.createObjectURL(o),n=document.createElement("a");n.href=a,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n),setTimeout((()=>{URL.revokeObjectURL(a)}),2e3)}async function lr(e){try{return(await navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:e}}})).getTracks().forEach((e=>e.stop())),!0}catch(e){return!1}}rr(),window.addEventListener("focus",(()=>{})),document.addEventListener("visibilitychange",(async()=>{"visible"===document.visibilityState&&rr(),"visible"===document.visibilityState&&bi.paused&&bi.play().catch((e=>{}))}));